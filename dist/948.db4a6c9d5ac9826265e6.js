"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[948],{1948:(e,t,s)=>{s.r(t),s.d(t,{SwapLinkForm:()=>l});var i=s(4050),a=s.n(i),n=s(2592),r=s(9182);class l{constructor(e,t,s,i,a){this.ui=document.createElement("div"),this.defaultRoyalties=t,this.submitCallback=s,this.walletConnect=i,this.algoIndexer=a,this.data={},this.isAssetCreator=!1,this.numNfts=0,this.ui.innerHTML=`<h4>Create swap link</h4>\n        <form>\n                    <div class="mb-3" id="nfts">\n                    </div>\n                    <div class="mb-3">\n                        <label for="inputAlgoAddress" class="form-label">Receiver</label>\n                        <input type="text" class="form-control" id="inputAlgoAddress" pattern="[A-Z2-7]{58}"\n                            aria-describedby="AlgoAddressdHelp" required>\n                        <div id="AlgoAddressdHelp" class="form-text">Algorand Wallet Address</div>\n                    </div>\n                    <div class="mb-3">\n                        <label for="inputPrice" class="form-label">Price</label>\n\n                        <div class="row">\n                            <div class="col">\n                                <input type="number" class="form-control" id="inputPrice" min="0" step="1" required>\n                            </div>\n                            <div class="col">\n                                <select class="form-select" id="inputCurrency" aria-label="Select currency">\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="mb-3">\n                      <div class="row">\n                        <div class="col-6">\n                          <div class="d-flex justify-content-between">\n                          <label for="inputRoyalties" class="form-label">Creator royalty</label>\n                          <span id="royaltiesValueLabel" class="royalties">0&percnt;</span>\n                      </div>\n\n                      <input type="range" class="form-range" value="${this.defaultRoyalties}" min="0" max="10" step="0.5" id="inputRoyalties"\n                          aria-describedby="royaltiesdHelp">\n                      <div id="royaltiesdHelp" class="form-text"></div>\n                        </div>\n                        <div class="col-6 position-relative">\n                        <span class="position-absolute heart" id="royaltiesLoveRed" hidden>&#10084;</span>\n                        <span class="position-absolute heart" id="royaltiesLoveGreen">&#128154;</span>\n                        \n                        </div>\n                      </div>\n                       \n                    </div>\n                    <div class="mb-3 form-check">\n                        <input type="checkbox" class="form-check-input" id="checkAcceptRisk" required>\n                        <label class="form-check-label" for="checkAcceptRisk">I accept to use this tool at my own\n                            risk</label>\n                    </div>\n                    <button type="submit" id="buttonSubmit" class="btn btn-generate fw-bold">Preview</button>\n\n\n                </form>`,this.addNFT();const n=this.ui.querySelector("#inputCurrency");let r=!0;for(const t of e){const e=document.createElement("option");e.textContent=t.name,e.value=t.assetId,r&&(e.selected=!0),n.append(e),r=!1}this.ui.querySelector("#inputRoyalties").addEventListener("input",this.royaltiesChange.bind(this),!1),this.ui.querySelector("#inputCurrency").addEventListener("change",this.currencyChange.bind(this),!1),this.ui.querySelector("form").addEventListener("submit",this.submitForm.bind(this),!1),this.ui.querySelector("#inputRoyalties").dispatchEvent(new Event("input"))}addNFT(e){if(e&&e.currentTarget&&(e.currentTarget.hidden=!0),this.numNfts>=r.Z.maxNfts)return;const t=this.ui.querySelector("#nfts"),s=document.createElement("div");s.className="row mt-2",s.innerHTML=`\n      <div class="col-6">\n        <label for="inputAssetId" class="form-label">NFT</label>\n        <input type="text" class="form-control" id="inputAssetId" data-id="${this.numNfts}" aria-describedby="assetIdHelp"\n            pattern="\\d*">\n        <div id="assetIdHelp" class="form-text">ASA asset ID</div>\n      </div>\n      <div class="col-1">\n        <br>\n        <a href="javascript:void(0);" id="add-nft" hidden>\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-square mt-3" viewBox="0 0 16 16">\n            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>\n          </svg>\n        </a>\n      </div>\n      <div class="col-5 text-center">\n        <img src="default.png" id="imgAssetPreview" width="auto" height="95">\n      </div>\n    `;const i=s.querySelector("#inputAssetId");0===this.numNfts&&(i.required=!0),i.addEventListener("focusout",this.assetIdFocusOut.bind(this),!1);const a=s.querySelector("#add-nft");this.numNfts<r.Z.maxNfts-1&&(a.hidden=!1,a.addEventListener("click",this.addNFT.bind(this),!1)),t.append(s),this.numNfts++}async assetIdFocusOut(e){const t=e.currentTarget;this.displayAssetInfo(t)}async displayAssetInfo(e){const t=e.parentNode.parentNode,s=t.querySelector("#assetIdHelp"),i=t.querySelector("#imgAssetPreview"),a=this.ui.querySelector("#inputRoyalties"),r=this.ui.querySelector("#royaltiesdHelp"),l=parseInt(e.value);if(isNaN(l))s.innerHTML='<span class="text-danger">Wrong asset ID format</span>',a.disabled=!1,r.textContent="";else{try{const e=await this.algoIndexer.lookupAssetByID(l).do();s.innerHTML=`<span class="text-success">${e.asset.params.name} (${e.asset.params["unit-name"]})</span>`,e.asset.params.creator===this.walletConnect.walletAddress?this.isAssetCreator=!0:this.isAssetCreator=!1}catch(e){console.log(e),s.innerHTML=`<span class="text-danger">Error: Asset with ID ${l} not found</span>`,this.isAssetCreator=!1}this.checkRoyaltiesAvailability(),(0,n.g)(l,i,200)}}currencyChange(e){this.checkRoyaltiesAvailability()}async checkRoyaltiesAvailability(){const e=this.ui.querySelector("#inputCurrency"),t=this.ui.querySelector("#inputRoyalties"),s=this.ui.querySelector("#royaltiesdHelp"),i=this.ui.querySelector("#royaltiesLoveGreen"),a=this.ui.querySelector("#royaltiesLoveRed");let n=!1;if(this.numNfts>1){let e="";console.log("--");for(const t of this.ui.querySelectorAll("#inputAssetId"))if(t.value&&!isNaN(t.value))try{const s=await this.algoIndexer.lookupAssetByID(parseInt(t.value)).do();console.log(s.asset.params.creator),e&&e!=s.asset.params.creator&&(n=!0),e=s.asset.params.creator}catch(e){console.error(e)}}console.log(n),"algo"!==e.value||this.isAssetCreator||n?(t.value=0,t.disabled=!0,"algo"!==e.value?s.textContent="Royalty not available for other token than Algo":this.isAssetCreator?s.textContent="You're the creator of this asset, royalty disabled.":n&&(s.textContent="Multiple creators detected, royalty disabled."),i.hidden=!0,a.hidden=!0):(t.disabled=!1,s.textContent="",i.hidden=!1),t.dispatchEvent(new Event("input"))}royaltiesChange(e){const t=this.ui.querySelector("#inputRoyalties");this.ui.querySelector("#royaltiesValueLabel").textContent=`${t.value} %`;const s=this.ui.querySelector("#royaltiesLoveGreen"),i=this.ui.querySelector("#royaltiesLoveRed"),a=Number(t.min),n=Number(t.max),r=1+(t.value-t.min)/(t.max-t.min)*3.5;if(s.style=`font-size: ${r}rem`,t.value>a+(n-a)/2){const e=(t.value-(a+(n-a)/2))/((n-a)/2);let l="";t.value===t.max&&(l="animation: animateHeart 1.2s infinite;"),i.hidden=!1,i.style=`font-size: ${r}rem; ${l}`,s.style=`font-size: ${r}rem; opacity: ${1-e}`}else i.hidden=!0}async validate(){await this.checkRoyaltiesAvailability();const e=[];if(this.ui.querySelectorAll("#inputAssetId").forEach((async t=>{if(t.value&&!isNaN(t.value))e.push(parseInt(t.value,10)),await this.displayAssetInfo(t);else if(t.value&&isNaN(t.value))throw new Error(`Wrong format for asset id ${t.value}`)})),this.data.assetIds=e,this.data.buyerAddress=this.ui.querySelector("#inputAlgoAddress").value,this.data.price=this.ui.querySelector("#inputPrice").value,this.data.currency=this.ui.querySelector("#inputCurrency").value,this.data.royaltiesPercent=this.ui.querySelector("#inputRoyalties").value,this.data.acceptRisk=this.ui.querySelector("#checkAcceptRisk").checked,0===this.data.assetIds.length)throw new Error("No asset id provided or wrong format");if(!a().isValidAddress(this.data.buyerAddress))throw new Error("Alogorand wallet address is not valid");if(isNaN(this.data.price))throw new Error("Price is not a number");if(isNaN(this.data.royaltiesPercent))throw new Error("Royalties value is not a number");if(!this.data.acceptRisk)throw new Error("Risk not accepted")}async submitForm(e){e.preventDefault();try{await this.validate()}catch(e){alert(e)}this.submitCallback&&this.submitCallback(this)}makeBusy(){const e=this.ui.querySelector("#buttonSubmit");e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n    Preview'}stopBusy(){const e=this.ui.querySelector("#buttonSubmit");e.textContent="Preview",e.disabled=!1}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SCxnQkFDUEcsS0FBS0gsZUFBZUcsS0FFeEIsQ0FFQTBGLFdBQ0UsTUFBTUMsRUFBZTNGLEtBQUtDLEdBQUdTLGNBQWMsaUJBQzNDaUYsRUFBYTNDLFVBQVcsRUFFeEIyQyxFQUFhcEYsVUFBWSxzR0FFM0IsQ0FFQXFGLFdBQ0UsTUFBTUQsRUFBZTNGLEtBQUtDLEdBQUdTLGNBQWMsaUJBQzNDaUYsRUFBYTdFLFlBQWMsVUFDM0I2RSxFQUFhM0MsVUFBVyxDQUMxQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXRvbWl4d2FwLy4vc3JjL3N3YXAtbGluay1mb3JtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbGdvc2RrIGZyb20gXCJhbGdvc2RrXCI7XG5pbXBvcnQgeyBsb2FkQXNzZXRJbWFnZSB9IGZyb20gXCIuL2Fzc2V0LWRldGFpbHNcIjtcbmltcG9ydCBjb25maWcgZnJvbSBcIi4vY29uZmlnLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBTd2FwTGlua0Zvcm0ge1xuICBjb25zdHJ1Y3RvcihcbiAgICBjdXJyZW5jaWVzLFxuICAgIGRlZmF1bHRSb3lhbHRpZXMsXG4gICAgc3VibWl0Q2FsbGJhY2ssXG4gICAgd2FsbGV0Q29ubmVjdCxcbiAgICBhbGdvSW5kZXhlclxuICApIHtcbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLmRlZmF1bHRSb3lhbHRpZXMgPSBkZWZhdWx0Um95YWx0aWVzO1xuICAgIHRoaXMuc3VibWl0Q2FsbGJhY2sgPSBzdWJtaXRDYWxsYmFjaztcbiAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gZmFsc2U7XG4gICAgdGhpcy5udW1OZnRzID0gMDtcblxuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5DcmVhdGUgc3dhcCBsaW5rPC9oND5cbiAgICAgICAgPGZvcm0+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCIgaWQ9XCJuZnRzXCI+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0QWxnb0FkZHJlc3NcIiBjbGFzcz1cImZvcm0tbGFiZWxcIj5SZWNlaXZlcjwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwiaW5wdXRBbGdvQWRkcmVzc1wiIHBhdHRlcm49XCJbQS1aMi03XXs1OH1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9XCJBbGdvQWRkcmVzc2RIZWxwXCIgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwiQWxnb0FkZHJlc3NkSGVscFwiIGNsYXNzPVwiZm9ybS10ZXh0XCI+QWxnb3JhbmQgV2FsbGV0IEFkZHJlc3M8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiaW5wdXRQcmljZVwiIGNsYXNzPVwiZm9ybS1sYWJlbFwiPlByaWNlPC9sYWJlbD5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJudW1iZXJcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwiaW5wdXRQcmljZVwiIG1pbj1cIjBcIiBzdGVwPVwiMVwiIHJlcXVpcmVkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzcz1cImZvcm0tc2VsZWN0XCIgaWQ9XCJpbnB1dEN1cnJlbmN5XCIgYXJpYS1sYWJlbD1cIlNlbGVjdCBjdXJyZW5jeVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTNcIj5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLTZcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiaW5wdXRSb3lhbHRpZXNcIiBjbGFzcz1cImZvcm0tbGFiZWxcIj5DcmVhdG9yIHJveWFsdHk8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD1cInJveWFsdGllc1ZhbHVlTGFiZWxcIiBjbGFzcz1cInJveWFsdGllc1wiPjAmcGVyY250Ozwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwicmFuZ2VcIiBjbGFzcz1cImZvcm0tcmFuZ2VcIiB2YWx1ZT1cIiR7dGhpcy5kZWZhdWx0Um95YWx0aWVzfVwiIG1pbj1cIjBcIiBtYXg9XCIxMFwiIHN0ZXA9XCIwLjVcIiBpZD1cImlucHV0Um95YWx0aWVzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1kZXNjcmliZWRieT1cInJveWFsdGllc2RIZWxwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cInJveWFsdGllc2RIZWxwXCIgY2xhc3M9XCJmb3JtLXRleHRcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC02IHBvc2l0aW9uLXJlbGF0aXZlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInBvc2l0aW9uLWFic29sdXRlIGhlYXJ0XCIgaWQ9XCJyb3lhbHRpZXNMb3ZlUmVkXCIgaGlkZGVuPiYjMTAwODQ7PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJwb3NpdGlvbi1hYnNvbHV0ZSBoZWFydFwiIGlkPVwicm95YWx0aWVzTG92ZUdyZWVuXCI+JiMxMjgxNTQ7PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItMyBmb3JtLWNoZWNrXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCIgaWQ9XCJjaGVja0FjY2VwdFJpc2tcIiByZXF1aXJlZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cImZvcm0tY2hlY2stbGFiZWxcIiBmb3I9XCJjaGVja0FjY2VwdFJpc2tcIj5JIGFjY2VwdCB0byB1c2UgdGhpcyB0b29sIGF0IG15IG93blxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpc2s8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgaWQ9XCJidXR0b25TdWJtaXRcIiBjbGFzcz1cImJ0biBidG4tZ2VuZXJhdGUgZnctYm9sZFwiPlByZXZpZXc8L2J1dHRvbj5cblxuXG4gICAgICAgICAgICAgICAgPC9mb3JtPmA7XG5cbiAgICAvL2FkZCBuZnQgZm9ybVxuICAgIHRoaXMuYWRkTkZUKCk7XG5cbiAgICAvL2FkZCBjdXJyZW5jaWVzXG4gICAgY29uc3QgaW5wdXRDdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpO1xuXG4gICAgbGV0IGZpcnN0ID0gdHJ1ZTtcblxuICAgIGZvciAoY29uc3QgY3VycmVuY3kgb2YgY3VycmVuY2llcykge1xuICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IGN1cnJlbmN5Lm5hbWU7XG4gICAgICBvcHRpb24udmFsdWUgPSBjdXJyZW5jeS5hc3NldElkO1xuXG4gICAgICBpZiAoZmlyc3QpIHtcbiAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaW5wdXRDdXJyZW5jeS5hcHBlbmQob3B0aW9uKTtcblxuICAgICAgZmlyc3QgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvL2xpc3RlbiB0byBjaGFuZ2UgZXZlbnRzXG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgdGhpcy5yb3lhbHRpZXNDaGFuZ2UuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRDdXJyZW5jeVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5jdXJyZW5jeUNoYW5nZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAvL2xpc3RlbiB0byBmb3JtIHN1Ym1pdCBldmVudFxuICAgIHRoaXMudWlcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRGb3JtLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIC8vdXBkYXRlIHJveWFsdGllc1xuICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFJveWFsdGllc1wiKS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcbiAgfVxuXG4gIGFkZE5GVChldmVudCkge1xuICAgIC8vaGlkZSAnKycgYnV0dG9uIHRoYXQgaGF2ZSBiZWVuIGp1c3QgY2xpY2tlZFxuICAgIGlmIChldmVudCAmJiBldmVudC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgICBldmVudC5jdXJyZW50VGFyZ2V0LmhpZGRlbiA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubnVtTmZ0cyA+PSBjb25maWcubWF4TmZ0cykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdHNEaXYgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjbmZ0c1wiKTtcblxuICAgIGNvbnN0IG5ld05mdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbmV3TmZ0LmNsYXNzTmFtZSA9IFwicm93IG10LTJcIjtcbiAgICBuZXdOZnQuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImNvbC02XCI+XG4gICAgICAgIDxsYWJlbCBmb3I9XCJpbnB1dEFzc2V0SWRcIiBjbGFzcz1cImZvcm0tbGFiZWxcIj5ORlQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwiaW5wdXRBc3NldElkXCIgZGF0YS1pZD1cIiR7dGhpcy5udW1OZnRzfVwiIGFyaWEtZGVzY3JpYmVkYnk9XCJhc3NldElkSGVscFwiXG4gICAgICAgICAgICBwYXR0ZXJuPVwiXFxcXGQqXCI+XG4gICAgICAgIDxkaXYgaWQ9XCJhc3NldElkSGVscFwiIGNsYXNzPVwiZm9ybS10ZXh0XCI+QVNBIGFzc2V0IElEPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtMVwiPlxuICAgICAgICA8YnI+XG4gICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMCk7XCIgaWQ9XCJhZGQtbmZ0XCIgaGlkZGVuPlxuICAgICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjRcIiBoZWlnaHQ9XCIyNFwiIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBjbGFzcz1cImJpIGJpLXBsdXMtc3F1YXJlIG10LTNcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+XG4gICAgICAgICAgICA8cGF0aCBkPVwiTTE0IDFhMSAxIDAgMCAxIDEgMXYxMmExIDEgMCAwIDEtMSAxSDJhMSAxIDAgMCAxLTEtMVYyYTEgMSAwIDAgMSAxLTFoMTJ6TTIgMGEyIDIgMCAwIDAtMiAydjEyYTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlYyYTIgMiAwIDAgMC0yLTJIMnpcIi8+XG4gICAgICAgICAgICA8cGF0aCBkPVwiTTggNGEuNS41IDAgMCAxIC41LjV2M2gzYS41LjUgMCAwIDEgMCAxaC0zdjNhLjUuNSAwIDAgMS0xIDB2LTNoLTNhLjUuNSAwIDAgMSAwLTFoM3YtM0EuNS41IDAgMCAxIDggNHpcIi8+XG4gICAgICAgICAgPC9zdmc+XG4gICAgICAgIDwvYT5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImNvbC01IHRleHQtY2VudGVyXCI+XG4gICAgICAgIDxpbWcgc3JjPVwiZGVmYXVsdC5wbmdcIiBpZD1cImltZ0Fzc2V0UHJldmlld1wiIHdpZHRoPVwiYXV0b1wiIGhlaWdodD1cIjk1XCI+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgY29uc3QgaW5wdXRBc3NldElkID0gbmV3TmZ0LnF1ZXJ5U2VsZWN0b3IoYCNpbnB1dEFzc2V0SWRgKTtcblxuICAgIGlmICh0aGlzLm51bU5mdHMgPT09IDApIHtcbiAgICAgIGlucHV0QXNzZXRJZC5yZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaW5wdXRBc3NldElkLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcImZvY3Vzb3V0XCIsXG4gICAgICB0aGlzLmFzc2V0SWRGb2N1c091dC5iaW5kKHRoaXMpLFxuICAgICAgZmFsc2VcbiAgICApO1xuXG4gICAgY29uc3QgYWRkTGluayA9IG5ld05mdC5xdWVyeVNlbGVjdG9yKGAjYWRkLW5mdGApO1xuXG4gICAgaWYgKHRoaXMubnVtTmZ0cyA8IGNvbmZpZy5tYXhOZnRzIC0gMSkge1xuICAgICAgYWRkTGluay5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIGFkZExpbmsuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYWRkTkZULmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBuZnRzRGl2LmFwcGVuZChuZXdOZnQpO1xuXG4gICAgdGhpcy5udW1OZnRzKys7XG4gIH1cblxuICBhc3luYyBhc3NldElkRm9jdXNPdXQoZXZlbnQpIHtcbiAgICBjb25zdCBpbnB1dEFzc2V0SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgIHRoaXMuZGlzcGxheUFzc2V0SW5mbyhpbnB1dEFzc2V0SWQpO1xuICB9XG5cbiAgYXN5bmMgZGlzcGxheUFzc2V0SW5mbyhpbnB1dEFzc2V0SWQpIHtcbiAgICBjb25zdCBwYXJlbnQgPSBpbnB1dEFzc2V0SWQucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gICAgY29uc3QgYXNzZXRJZEhlbHAgPSBwYXJlbnQucXVlcnlTZWxlY3RvcihcIiNhc3NldElkSGVscFwiKTtcbiAgICBjb25zdCBhc3NldEltZyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKFwiI2ltZ0Fzc2V0UHJldmlld1wiKTtcbiAgICAvL2NvbnN0IGlucHV0QXNzZXRJZCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEFzc2V0SWRcIik7XG4gICAgY29uc3QgaW5wdXRSb3lhbHRpZXMgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIik7XG4gICAgY29uc3Qgcm95YWx0aWVzZEhlbHAgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzZEhlbHBcIik7XG4gICAgY29uc3QgYXNzZXRJRCA9IHBhcnNlSW50KGlucHV0QXNzZXRJZC52YWx1ZSk7XG5cbiAgICAvL3JldHJlaXZlIGFzc2V0IGluZm9zXG4gICAgaWYgKCFpc05hTihhc3NldElEKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlci5sb29rdXBBc3NldEJ5SUQoYXNzZXRJRCkuZG8oKTtcblxuICAgICAgICBhc3NldElkSGVscC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJ0ZXh0LXN1Y2Nlc3NcIj4ke3Jlc3VsdC5hc3NldC5wYXJhbXMubmFtZX0gKCR7cmVzdWx0LmFzc2V0LnBhcmFtc1tcInVuaXQtbmFtZVwiXX0pPC9zcGFuPmA7XG5cbiAgICAgICAgY29uc3QgY3JlYXRvckFkZHJlc3MgPSByZXN1bHQuYXNzZXQucGFyYW1zLmNyZWF0b3I7XG5cbiAgICAgICAgaWYgKGNyZWF0b3JBZGRyZXNzID09PSB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcykge1xuICAgICAgICAgIHRoaXMuaXNBc3NldENyZWF0b3IgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuaXNBc3NldENyZWF0b3IgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIGFzc2V0SWRIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+RXJyb3I6IEFzc2V0IHdpdGggSUQgJHthc3NldElEfSBub3QgZm91bmQ8L3NwYW4+YDtcblxuICAgICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2hlY2tSb3lhbHRpZXNBdmFpbGFiaWxpdHkoKTtcblxuICAgICAgLy9sb2FkIGFzc2V0IGltYXpnZVxuICAgICAgbG9hZEFzc2V0SW1hZ2UoYXNzZXRJRCwgYXNzZXRJbWcsIDIwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFzc2V0SWRIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+V3JvbmcgYXNzZXQgSUQgZm9ybWF0PC9zcGFuPmA7XG5cbiAgICAgIGlucHV0Um95YWx0aWVzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICByb3lhbHRpZXNkSGVscC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgfVxuICB9XG5cbiAgY3VycmVuY3lDaGFuZ2UoZXZlbnQpIHtcbiAgICB0aGlzLmNoZWNrUm95YWx0aWVzQXZhaWxhYmlsaXR5KCk7XG4gIH1cblxuICBhc3luYyBjaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpIHtcblxuICAgIGNvbnN0IGlucHV0Q3VycmVuY3kgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRDdXJyZW5jeVwiKTtcbiAgICBjb25zdCBpbnB1dFJveWFsdGllcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFJveWFsdGllc1wiKTtcbiAgICBjb25zdCByb3lhbHRpZXNkSGVscCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNyb3lhbHRpZXNkSGVscFwiKTtcbiAgICBjb25zdCBncmVlbkhlYXJ0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc0xvdmVHcmVlblwiKTtcbiAgICBjb25zdCByZWRIZWFydCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNyb3lhbHRpZXNMb3ZlUmVkXCIpO1xuXG4gICAgLy9pZiB0aGVyZSBpZiBtdWx0aXBsZSBhc3NldHMsIGNoZWNrIGlmIHRoZXkncmUgZnJvbSBtdWx0aXBsZSBjcmVhdG9yc1xuICAgIGxldCBtdWx0aXBsZUNyZWF0b3JzID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5udW1OZnRzID4gMSkge1xuXG4gICAgICBjb25zdCBhc3NldElkcyA9IFtdO1xuXG4gICAgICBsZXQgcHJldkNyZWF0b3IgPSAnJztcbiAgICAgIGNvbnNvbGUubG9nKFwiLS1cIilcbiAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjaW5wdXRBc3NldElkXCIpKXtcbiAgICAgICAgaWYgKGUudmFsdWUgJiYgIWlzTmFOKGUudmFsdWUpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXIubG9va3VwQXNzZXRCeUlEKHBhcnNlSW50KGUudmFsdWUpKS5kbygpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0LmFzc2V0LnBhcmFtcy5jcmVhdG9yKTtcbiAgICAgICAgICAgIGlmIChwcmV2Q3JlYXRvciAmJiBwcmV2Q3JlYXRvciAhPSByZXN1bHQuYXNzZXQucGFyYW1zLmNyZWF0b3Ipe1xuICAgICAgICAgICAgICBtdWx0aXBsZUNyZWF0b3JzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJldkNyZWF0b3IgPSByZXN1bHQuYXNzZXQucGFyYW1zLmNyZWF0b3I7XG5cbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2cobXVsdGlwbGVDcmVhdG9ycylcblxuICAgIGlmIChcbiAgICAgIGlucHV0Q3VycmVuY3kudmFsdWUgIT09IFwiYWxnb1wiIHx8XG4gICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yIHx8XG4gICAgICBtdWx0aXBsZUNyZWF0b3JzXG4gICAgKSB7XG4gICAgICBpbnB1dFJveWFsdGllcy52YWx1ZSA9IDA7XG4gICAgICBpbnB1dFJveWFsdGllcy5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgIGlmIChpbnB1dEN1cnJlbmN5LnZhbHVlICE9PSBcImFsZ29cIikge1xuICAgICAgICByb3lhbHRpZXNkSGVscC50ZXh0Q29udGVudCA9XG4gICAgICAgICAgXCJSb3lhbHR5IG5vdCBhdmFpbGFibGUgZm9yIG90aGVyIHRva2VuIHRoYW4gQWxnb1wiO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzQXNzZXRDcmVhdG9yKSB7XG4gICAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIllvdSdyZSB0aGUgY3JlYXRvciBvZiB0aGlzIGFzc2V0LCByb3lhbHR5IGRpc2FibGVkLlwiO1xuICAgICAgfSBlbHNlIGlmIChtdWx0aXBsZUNyZWF0b3JzKSB7XG4gICAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIk11bHRpcGxlIGNyZWF0b3JzIGRldGVjdGVkLCByb3lhbHR5IGRpc2FibGVkLlwiO1xuICAgICAgfVxuXG4gICAgICBncmVlbkhlYXJ0LmhpZGRlbiA9IHRydWU7XG4gICAgICByZWRIZWFydC5oaWRkZW4gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL2lucHV0Um95YWx0aWVzLnZhbHVlID0gdGhpcy5kZWZhdWx0Um95YWx0aWVzO1xuICAgICAgaW5wdXRSb3lhbHRpZXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgIGdyZWVuSGVhcnQuaGlkZGVuID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaW5wdXRSb3lhbHRpZXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiKSk7XG4gIH1cblxuICByb3lhbHRpZXNDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCByb3lhbHRpZXNTbGlkZXIgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIik7XG5cbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNyb3lhbHRpZXNWYWx1ZUxhYmVsXCJcbiAgICApLnRleHRDb250ZW50ID0gYCR7cm95YWx0aWVzU2xpZGVyLnZhbHVlfSAlYDtcblxuICAgIGNvbnN0IGdyZWVuSGVhcnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzTG92ZUdyZWVuXCIpO1xuICAgIGNvbnN0IHJlZEhlYXJ0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc0xvdmVSZWRcIik7XG5cbiAgICBjb25zdCBtaW5Gb250U2l6ZSA9IDEuMDtcbiAgICBjb25zdCBtYXhGb250U2l6ZSA9IDQuNTtcbiAgICBjb25zdCBzbGlkZXJNaW4gPSBOdW1iZXIocm95YWx0aWVzU2xpZGVyLm1pbik7XG4gICAgY29uc3Qgc2xpZGVyTWF4ID0gTnVtYmVyKHJveWFsdGllc1NsaWRlci5tYXgpO1xuXG4gICAgY29uc3QgZm9udFNpemUgPVxuICAgICAgbWluRm9udFNpemUgK1xuICAgICAgKG1heEZvbnRTaXplIC0gbWluRm9udFNpemUpICpcbiAgICAgICAgKChyb3lhbHRpZXNTbGlkZXIudmFsdWUgLSByb3lhbHRpZXNTbGlkZXIubWluKSAvXG4gICAgICAgICAgKHJveWFsdGllc1NsaWRlci5tYXggLSByb3lhbHRpZXNTbGlkZXIubWluKSk7XG5cbiAgICBncmVlbkhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW1gO1xuXG4gICAgaWYgKHJveWFsdGllc1NsaWRlci52YWx1ZSA+IHNsaWRlck1pbiArIChzbGlkZXJNYXggLSBzbGlkZXJNaW4pIC8gMikge1xuICAgICAgY29uc3QgcmVkSGVhcnRPcGFjaXR5ID1cbiAgICAgICAgKHJveWFsdGllc1NsaWRlci52YWx1ZSAtIChzbGlkZXJNaW4gKyAoc2xpZGVyTWF4IC0gc2xpZGVyTWluKSAvIDIpKSAvXG4gICAgICAgICgoc2xpZGVyTWF4IC0gc2xpZGVyTWluKSAvIDIpO1xuXG4gICAgICBsZXQgYW5pbWF0aW9uID0gXCJcIjtcbiAgICAgIGlmIChyb3lhbHRpZXNTbGlkZXIudmFsdWUgPT09IHJveWFsdGllc1NsaWRlci5tYXgpIHtcbiAgICAgICAgYW5pbWF0aW9uID0gXCJhbmltYXRpb246IGFuaW1hdGVIZWFydCAxLjJzIGluZmluaXRlO1wiO1xuICAgICAgfVxuXG4gICAgICByZWRIZWFydC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIHJlZEhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW07ICR7YW5pbWF0aW9ufWA7XG4gICAgICBncmVlbkhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW07IG9wYWNpdHk6ICR7XG4gICAgICAgIDEgLSByZWRIZWFydE9wYWNpdHlcbiAgICAgIH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICByZWRIZWFydC5oaWRkZW4gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlKCkge1xuXG4gICAgYXdhaXQgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuXG4gICAgY29uc3QgYXNzZXRJZHMgPSBbXTtcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjaW5wdXRBc3NldElkXCIpLmZvckVhY2goYXN5bmMgKGUpID0+IHtcbiAgICAgIGlmIChlLnZhbHVlICYmICFpc05hTihlLnZhbHVlKSkge1xuICAgICAgICBhc3NldElkcy5wdXNoKHBhcnNlSW50KGUudmFsdWUsIDEwKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGlzcGxheUFzc2V0SW5mbyhlKTtcbiAgICAgIH0gZWxzZSBpZiAoZS52YWx1ZSAmJiBpc05hTihlLnZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFdyb25nIGZvcm1hdCBmb3IgYXNzZXQgaWQgJHtlLnZhbHVlfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRhLmFzc2V0SWRzID0gYXNzZXRJZHM7XG4gICAgdGhpcy5kYXRhLmJ1eWVyQWRkcmVzcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEFsZ29BZGRyZXNzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5wcmljZSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFByaWNlXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5jdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5yb3lhbHRpZXNQZXJjZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5hY2NlcHRSaXNrID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NoZWNrQWNjZXB0Umlza1wiKS5jaGVja2VkO1xuXG4gICAgaWYgKHRoaXMuZGF0YS5hc3NldElkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGFzc2V0IGlkIHByb3ZpZGVkIG9yIHdyb25nIGZvcm1hdFwiKTtcbiAgICB9IGVsc2UgaWYgKCFhbGdvc2RrLmlzVmFsaWRBZGRyZXNzKHRoaXMuZGF0YS5idXllckFkZHJlc3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbG9nb3JhbmQgd2FsbGV0IGFkZHJlc3MgaXMgbm90IHZhbGlkXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnByaWNlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJpY2UgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnJveWFsdGllc1BlcmNlbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSb3lhbHRpZXMgdmFsdWUgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuZGF0YS5hY2NlcHRSaXNrKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSaXNrIG5vdCBhY2NlcHRlZFwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdWJtaXRGb3JtKGV2ZW50KSB7XG4gICAgLy9jYW5jZWwgZGVmYXVsdCBiZWhhdmlvdXIgd2hlbiBzdWJtaXRpbmcgYSBmb3JtXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnZhbGlkYXRlKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhbGVydChlcnIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnN1Ym1pdENhbGxiYWNrKSB7XG4gICAgICB0aGlzLnN1Ym1pdENhbGxiYWNrKHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIG1ha2VCdXN5KCkge1xuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b25TdWJtaXRcIik7XG4gICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgIHN1Ym1pdEJ1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgUHJldmlld2A7XG4gIH1cblxuICBzdG9wQnVzeSgpIHtcbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uU3VibWl0XCIpO1xuICAgIHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiUHJldmlld1wiO1xuICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59XG4iXSwibmFtZXMiOlsiU3dhcExpbmtGb3JtIiwiY29uc3RydWN0b3IiLCJjdXJyZW5jaWVzIiwiZGVmYXVsdFJveWFsdGllcyIsInN1Ym1pdENhbGxiYWNrIiwid2FsbGV0Q29ubmVjdCIsImFsZ29JbmRleGVyIiwidGhpcyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiZGF0YSIsImlzQXNzZXRDcmVhdG9yIiwibnVtTmZ0cyIsImlubmVySFRNTCIsImFkZE5GVCIsImlucHV0Q3VycmVuY3kiLCJxdWVyeVNlbGVjdG9yIiwiZmlyc3QiLCJjdXJyZW5jeSIsIm9wdGlvbiIsInRleHRDb250ZW50IiwibmFtZSIsInZhbHVlIiwiYXNzZXRJZCIsInNlbGVjdGVkIiwiYXBwZW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJveWFsdGllc0NoYW5nZSIsImJpbmQiLCJjdXJyZW5jeUNoYW5nZSIsInN1Ym1pdEZvcm0iLCJkaXNwYXRjaEV2ZW50IiwiRXZlbnQiLCJldmVudCIsImN1cnJlbnRUYXJnZXQiLCJoaWRkZW4iLCJuZnRzRGl2IiwibmV3TmZ0IiwiY2xhc3NOYW1lIiwiaW5wdXRBc3NldElkIiwicmVxdWlyZWQiLCJhc3NldElkRm9jdXNPdXQiLCJhZGRMaW5rIiwiYXN5bmMiLCJkaXNwbGF5QXNzZXRJbmZvIiwicGFyZW50IiwicGFyZW50Tm9kZSIsImFzc2V0SWRIZWxwIiwiYXNzZXRJbWciLCJpbnB1dFJveWFsdGllcyIsInJveWFsdGllc2RIZWxwIiwiYXNzZXRJRCIsInBhcnNlSW50IiwiaXNOYU4iLCJkaXNhYmxlZCIsInJlc3VsdCIsImxvb2t1cEFzc2V0QnlJRCIsImRvIiwiYXNzZXQiLCJwYXJhbXMiLCJjcmVhdG9yIiwid2FsbGV0QWRkcmVzcyIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJjaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSIsImdyZWVuSGVhcnQiLCJyZWRIZWFydCIsIm11bHRpcGxlQ3JlYXRvcnMiLCJwcmV2Q3JlYXRvciIsImUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZXJyb3IiLCJyb3lhbHRpZXNTbGlkZXIiLCJzbGlkZXJNaW4iLCJOdW1iZXIiLCJtaW4iLCJzbGlkZXJNYXgiLCJtYXgiLCJmb250U2l6ZSIsInN0eWxlIiwicmVkSGVhcnRPcGFjaXR5IiwiYW5pbWF0aW9uIiwiYXNzZXRJZHMiLCJmb3JFYWNoIiwicHVzaCIsIkVycm9yIiwiYnV5ZXJBZGRyZXNzIiwicHJpY2UiLCJyb3lhbHRpZXNQZXJjZW50IiwiYWNjZXB0UmlzayIsImNoZWNrZWQiLCJsZW5ndGgiLCJwcmV2ZW50RGVmYXVsdCIsInZhbGlkYXRlIiwiYWxlcnQiLCJtYWtlQnVzeSIsInN1Ym1pdEJ1dHRvbiIsInN0b3BCdXN5Il0sInNvdXJjZVJvb3QiOiIifQ==