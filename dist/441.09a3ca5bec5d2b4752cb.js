"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[441],{9441:(e,s,n)=>{n.r(s),n.d(s,{SwapLinkAccept:()=>l});var t=n(5984),a=n(4050),i=n.n(a),r=n(2592);class l{constructor(e,s,n,t){this.walletConnect=s,this.algodClient=n,this.algoIndexer=t,this.ui=document.createElement("div"),this.fields={},this.signedTransferTxs,this.signedOptinCurrencyTx,this.resolveData(e)}async resolveData(e){const s=atob(e),n=JSON.parse(s);console.log(n),this.signedTransferTxs=n.signedTransferTxs.map((e=>t.X.base64ToSignedTx(e))),console.log(this.signedTransferTxs);const a=this.signedTransferTxs.map((e=>i().decodeSignedTransaction(e)));n.signedOptinCurrencyTx&&(this.signedOptinCurrencyTx=t.X.base64ToSignedTx(n.signedOptinCurrencyTx)),this.fields={assetIds:a.map((e=>e.txn.assetIndex)),sellerAddress:i().encodeAddress(a[0].txn.from.publicKey),buyerAddress:i().encodeAddress(a[0].txn.to.publicKey),price:n.price,currency:n.currency,royalties:n.royalties,groupID:a[0].txn.group,firstRound:a[0].txn.firstRound,lastRound:a[0].txn.lastRound},console.log(this.fields),(await this.algodClient.status().do())["last-round"]>=this.fields.lastRound?this.ui.innerHTML='<h4>Accept swap</h4>\n        <div class="alert alert-danger" role="alert">This link expired.</div>':this.fields.buyerAddress!==this.walletConnect.walletAddress?this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="alert alert-warning" role="alert">This swap can only be accepted by the following wallet:<br><span style="word-break: break-all;">${this.fields.buyerAddress}</span></div>`:(this.ui.innerHTML="<h4>Accept swap</h4>\n        Loading...",this.swapLinkManager=new t.X(this.walletConnect,this.algodClient,this.algoIndexer),this.generateTransactions())}async generateTransactions(){try{await this.swapLinkManager.generateTransactions(this.fields)}catch(e){this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="alert alert-danger" role="alert">${e.message}</div>`}this.displayUI()}displayUI(){const e=this.swapLinkManager.transactions,s=e.assetTransfers.map((e=>e.assetIndex)),n=(i().encodeAddress(e.assetTransfers[0].to.publicKey),i().encodeAddress(e.assetTransfers[0].from.publicKey));let t="";if(e.payment){let s,a=e.payment.amount;if("pay"===e.payment.type)a/=1e6,s="ALGO";else{let e="";360019122===this.swapLinkManager.currencyAsset.index&&(e="&#127844; "),s=`${this.swapLinkManager.currencyAsset.params["unit-name"]} ${e}(ASA ${this.swapLinkManager.currencyAsset.index})`}t=`<li>You'll send <span class="price">${a} ${s}</span><br>\n      <span class="wallet-info">TO ${n}</span></li>`}const a=this.swapLinkManager.assets.map((e=>`<strong><a href="https://www.nftexplorer.app/asset/${e.index}" target="_blank">${e.index}</a></strong> (${e.params.name})`));if(this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="row">\n            <div class="col-md-6">\n              <ul>\n                ${t}\n                <li>You'll receive asset${a.length>1?"s":""} ${a.join(", ")}</li>\n              </ul>\n            </div>\n            <div class="col-md-6 ">\n                <img src="default.png" id="imgAssetPreview" class="img-fluid">\n            </div>\n        </div>\n        <form>\n            <div class="mb-3 form-check">\n                <input type="checkbox" class="form-check-input" id="checkAcceptRisk" required>\n                <label class="form-check-label" for="checkAcceptRisk">I accept to use this tool at my own\n                    risk</label>\n            </div>\n            \n            <button type="submit" class="btn btn-generate fw-bold" id="buttonAccept">Accept & sign</button>\n        </form>`,this.ui.querySelector("form").addEventListener("submit",this.submitAccept.bind(this)),e.royaltiesPayment){const s=this.ui.querySelector("ul"),n=document.createElement("li");let t,a=e.royaltiesPayment.amount;"pay"===e.royaltiesPayment.type?(a/=1e6,t="ALGO"):t=e.royaltiesPayment.assetIndex;const r=i().encodeAddress(e.royaltiesPayment.to.publicKey);n.innerHTML=`You'll send <span class="price">${a} ${t}</span> to asset's creator &#128154;<br>\n      <span class="wallet-info">TO ${r}</span>`,s.append(n)}(0,r.g)(s[0],this.ui.querySelector("#imgAssetPreview"),512)}async submitAccept(e){e.preventDefault();const s=this.ui.querySelector("#buttonAccept");s.disabled=!0,s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n    Waiting for signatures...',this.swapLinkManager.signAndCommitTransactions(this.signedTransferTxs,this.signedOptinCurrencyTx,(()=>{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n        Sending transactions...'}),(()=>{s.hidden=!0;const e=this.swapLinkManager.assets.map((e=>`<a href="https://www.nftexplorer.app/asset/${e.index}" target="_blank">${e.index}</a> (${e.params.name})`));this.ui.innerHTML=`<h4>Swapped ðŸ¥³</h4>\n        You received asset${e.length>1?"s":""} ${e.join(", ")}.`}),(e=>{console.error(e),s.hidden=!0,this.ui.innerHTML=`<h4>Accept swap</h4>\n            <div class="alert alert-danger" role="alert">Error:<br>${e}</div>`}))}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MEJJLEVBQU1KLGNBQWNJLEVBQU1ILE9BQU9JLFVBR3hIekQsS0FBS0MsR0FBR21DLFVBQVksa0RBQ0FrQixFQUFVSSxPQUFTLEVBQUksSUFBTSxNQUFNSixFQUFVSyxLQUFLLFFBQVEsSUFFL0VuQixJQUNDMUIsUUFBUThELE1BQU1wQyxHQUdkZ0MsRUFBYUcsUUFBUyxFQUV0QjNFLEtBQUtDLEdBQUdtQyxVQUFZLDRGQUN5Q0ksU0FBVyxHQUc5RSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXRvbWl4d2FwLy4vc3JjL3N3YXAtbGluay1hY2NlcHQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3dhcExpbmtNYW5hZ2VyIH0gZnJvbSBcIi4vc3dhcC1saW5rLW1hbmFnZXJcIjtcbmltcG9ydCBhbGdvc2RrIGZyb20gXCJhbGdvc2RrXCI7XG5pbXBvcnQgeyBsb2FkQXNzZXRJbWFnZSB9IGZyb20gXCIuL2Fzc2V0LWRldGFpbHNcIjtcblxuZXhwb3J0IGNsYXNzIFN3YXBMaW5rQWNjZXB0IHtcbiAgY29uc3RydWN0b3Ioc3dhcERhdGEsIHdhbGxldENvbm5lY3QsIGFsZ29kQ2xpZW50LCBhbGdvSW5kZXhlcikge1xuICAgIHRoaXMud2FsbGV0Q29ubmVjdCA9IHdhbGxldENvbm5lY3Q7XG4gICAgdGhpcy5hbGdvZENsaWVudCA9IGFsZ29kQ2xpZW50O1xuICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgdGhpcy5maWVsZHMgPSB7fTtcbiAgICB0aGlzLnNpZ25lZFRyYW5zZmVyVHhzO1xuICAgIHRoaXMuc2lnbmVkT3B0aW5DdXJyZW5jeVR4O1xuXG4gICAgdGhpcy5yZXNvbHZlRGF0YShzd2FwRGF0YSk7XG4gIH1cblxuICBhc3luYyByZXNvbHZlRGF0YShzd2FwRGF0YSkge1xuICAgIC8vZGVjb2RlIGRhdGFcbiAgICBjb25zdCBkZWNvZGVkRGF0YSA9IGF0b2Ioc3dhcERhdGEpO1xuICAgIGNvbnN0IGpzb25EYXRhID0gSlNPTi5wYXJzZShkZWNvZGVkRGF0YSk7XG5cbiAgICBjb25zb2xlLmxvZyhqc29uRGF0YSk7XG5cbiAgICB0aGlzLnNpZ25lZFRyYW5zZmVyVHhzID0ganNvbkRhdGEuc2lnbmVkVHJhbnNmZXJUeHMubWFwKCh0eCkgPT4ge1xuICAgICAgcmV0dXJuIFN3YXBMaW5rTWFuYWdlci5iYXNlNjRUb1NpZ25lZFR4KHR4KTtcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKHRoaXMuc2lnbmVkVHJhbnNmZXJUeHMpO1xuXG4gICAgY29uc3QgZGVjb2RlZFNpZ25lZFRyYW5zYWN0aW9ucyA9IHRoaXMuc2lnbmVkVHJhbnNmZXJUeHMubWFwKCh0eCkgPT4ge1xuICAgICAgcmV0dXJuIGFsZ29zZGsuZGVjb2RlU2lnbmVkVHJhbnNhY3Rpb24odHgpO1xuICAgIH0pO1xuXG4gICAgaWYgKGpzb25EYXRhLnNpZ25lZE9wdGluQ3VycmVuY3lUeCkge1xuICAgICAgdGhpcy5zaWduZWRPcHRpbkN1cnJlbmN5VHggPSBTd2FwTGlua01hbmFnZXIuYmFzZTY0VG9TaWduZWRUeChcbiAgICAgICAganNvbkRhdGEuc2lnbmVkT3B0aW5DdXJyZW5jeVR4XG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuZmllbGRzID0ge1xuICAgICAgYXNzZXRJZHM6IGRlY29kZWRTaWduZWRUcmFuc2FjdGlvbnMubWFwKCh0eCkgPT4gdHgudHhuLmFzc2V0SW5kZXgpLFxuICAgICAgc2VsbGVyQWRkcmVzczogYWxnb3Nkay5lbmNvZGVBZGRyZXNzKFxuICAgICAgICBkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zWzBdLnR4bi5mcm9tLnB1YmxpY0tleVxuICAgICAgKSxcbiAgICAgIGJ1eWVyQWRkcmVzczogYWxnb3Nkay5lbmNvZGVBZGRyZXNzKFxuICAgICAgICBkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zWzBdLnR4bi50by5wdWJsaWNLZXlcbiAgICAgICksXG4gICAgICBwcmljZToganNvbkRhdGEucHJpY2UsXG4gICAgICBjdXJyZW5jeToganNvbkRhdGEuY3VycmVuY3ksXG4gICAgICByb3lhbHRpZXM6IGpzb25EYXRhLnJveWFsdGllcyxcbiAgICAgIGdyb3VwSUQ6IGRlY29kZWRTaWduZWRUcmFuc2FjdGlvbnNbMF0udHhuLmdyb3VwLFxuICAgICAgZmlyc3RSb3VuZDogZGVjb2RlZFNpZ25lZFRyYW5zYWN0aW9uc1swXS50eG4uZmlyc3RSb3VuZCxcbiAgICAgIGxhc3RSb3VuZDogZGVjb2RlZFNpZ25lZFRyYW5zYWN0aW9uc1swXS50eG4ubGFzdFJvdW5kLFxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLmZpZWxkcyk7XG5cbiAgICAvL2xvYWQgY3VycmVudCBibG9ja1xuICAgIGNvbnN0IG5vZGVTdGF0dXMgPSBhd2FpdCB0aGlzLmFsZ29kQ2xpZW50LnN0YXR1cygpLmRvKCk7XG4gICAgY29uc3QgbGFzdFJvdW5kID0gbm9kZVN0YXR1c1tcImxhc3Qtcm91bmRcIl07XG5cbiAgICBpZiAobGFzdFJvdW5kID49IHRoaXMuZmllbGRzLmxhc3RSb3VuZCkge1xuICAgICAgdGhpcy51aS5pbm5lckhUTUwgPSBgPGg0PkFjY2VwdCBzd2FwPC9oND5cbiAgICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0IGFsZXJ0LWRhbmdlclwiIHJvbGU9XCJhbGVydFwiPlRoaXMgbGluayBleHBpcmVkLjwvZGl2PmA7XG4gICAgfSBlbHNlIGlmICh0aGlzLmZpZWxkcy5idXllckFkZHJlc3MgIT09IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzKSB7XG4gICAgICB0aGlzLnVpLmlubmVySFRNTCA9IGA8aDQ+QWNjZXB0IHN3YXA8L2g0PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtd2FybmluZ1wiIHJvbGU9XCJhbGVydFwiPlRoaXMgc3dhcCBjYW4gb25seSBiZSBhY2NlcHRlZCBieSB0aGUgZm9sbG93aW5nIHdhbGxldDo8YnI+PHNwYW4gc3R5bGU9XCJ3b3JkLWJyZWFrOiBicmVhay1hbGw7XCI+JHt0aGlzLmZpZWxkcy5idXllckFkZHJlc3N9PC9zcGFuPjwvZGl2PmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5BY2NlcHQgc3dhcDwvaDQ+XG4gICAgICAgIExvYWRpbmcuLi5gO1xuXG4gICAgICB0aGlzLnN3YXBMaW5rTWFuYWdlciA9IG5ldyBTd2FwTGlua01hbmFnZXIoXG4gICAgICAgIHRoaXMud2FsbGV0Q29ubmVjdCxcbiAgICAgICAgdGhpcy5hbGdvZENsaWVudCxcbiAgICAgICAgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgKTtcbiAgICAgIHRoaXMuZ2VuZXJhdGVUcmFuc2FjdGlvbnMoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZW5lcmF0ZVRyYW5zYWN0aW9ucygpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zd2FwTGlua01hbmFnZXIuZ2VuZXJhdGVUcmFuc2FjdGlvbnModGhpcy5maWVsZHMpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhpcy51aS5pbm5lckhUTUwgPSBgPGg0PkFjY2VwdCBzd2FwPC9oND5cbiAgICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0IGFsZXJ0LWRhbmdlclwiIHJvbGU9XCJhbGVydFwiPiR7ZXJyLm1lc3NhZ2V9PC9kaXY+YDtcbiAgICB9XG5cbiAgICB0aGlzLmRpc3BsYXlVSSgpO1xuICB9XG5cbiAgZGlzcGxheVVJKCkge1xuICAgIC8vYWRkIHJveWFsdGllcyBpZiBuZWVkZWRcbiAgICBjb25zdCB0cmFuc2FjdGlvbnMgPSB0aGlzLnN3YXBMaW5rTWFuYWdlci50cmFuc2FjdGlvbnM7XG5cbiAgICBjb25zdCBhc3NldElkcyA9IHRyYW5zYWN0aW9ucy5hc3NldFRyYW5zZmVycy5tYXAoKHR4KSA9PiB0eC5hc3NldEluZGV4KTtcbiAgICBjb25zdCBidXllckFkZHJlc3MgPSBhbGdvc2RrLmVuY29kZUFkZHJlc3MoXG4gICAgICB0cmFuc2FjdGlvbnMuYXNzZXRUcmFuc2ZlcnNbMF0udG8ucHVibGljS2V5XG4gICAgKTtcbiAgICBjb25zdCBzZWxsZXJBZGRyZXNzID0gYWxnb3Nkay5lbmNvZGVBZGRyZXNzKFxuICAgICAgdHJhbnNhY3Rpb25zLmFzc2V0VHJhbnNmZXJzWzBdLmZyb20ucHVibGljS2V5XG4gICAgKTtcblxuICAgIGxldCBwcmljZUxJID0gXCJcIjtcblxuICAgIGlmICh0cmFuc2FjdGlvbnMucGF5bWVudCkge1xuICAgICAgbGV0IHByaWNlID0gdHJhbnNhY3Rpb25zLnBheW1lbnQuYW1vdW50O1xuICAgICAgbGV0IGN1cnJlbmN5U3RyaW5nO1xuXG4gICAgICBpZiAodHJhbnNhY3Rpb25zLnBheW1lbnQudHlwZSA9PT0gXCJwYXlcIikge1xuICAgICAgICAvL2NvbnZlcnQgbWljcm9hbGdvIHRvIGFsZ29cbiAgICAgICAgcHJpY2UgPSBwcmljZSAvIDEwMDAwMDA7XG4gICAgICAgIGN1cnJlbmN5U3RyaW5nID0gXCJBTEdPXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgZW1vamkgPSBcIlwiO1xuXG4gICAgICAgIGlmICh0aGlzLnN3YXBMaW5rTWFuYWdlci5jdXJyZW5jeUFzc2V0LmluZGV4ID09PSAzNjAwMTkxMjIpIHtcbiAgICAgICAgICBlbW9qaSA9IFwiJiMxMjc4NDQ7IFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVuY3lTdHJpbmcgPSBgJHt0aGlzLnN3YXBMaW5rTWFuYWdlci5jdXJyZW5jeUFzc2V0LnBhcmFtc1tcInVuaXQtbmFtZVwiXX0gJHtlbW9qaX0oQVNBICR7dGhpcy5zd2FwTGlua01hbmFnZXIuY3VycmVuY3lBc3NldC5pbmRleH0pYDtcbiAgICAgIH1cblxuICAgICAgcHJpY2VMSSA9IGA8bGk+WW91J2xsIHNlbmQgPHNwYW4gY2xhc3M9XCJwcmljZVwiPiR7cHJpY2V9ICR7Y3VycmVuY3lTdHJpbmd9PC9zcGFuPjxicj5cbiAgICAgIDxzcGFuIGNsYXNzPVwid2FsbGV0LWluZm9cIj5UTyAke3NlbGxlckFkZHJlc3N9PC9zcGFuPjwvbGk+YDtcbiAgICB9XG5cbiAgICBjb25zdCBhc3NldExpc3QgPSB0aGlzLnN3YXBMaW5rTWFuYWdlci5hc3NldHMubWFwKChhc3NldCkgPT4ge1xuICAgICAgcmV0dXJuIGA8c3Ryb25nPjxhIGhyZWY9XCJodHRwczovL3d3dy5uZnRleHBsb3Jlci5hcHAvYXNzZXQvJHthc3NldC5pbmRleH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke2Fzc2V0LmluZGV4fTwvYT48L3N0cm9uZz4gKCR7YXNzZXQucGFyYW1zLm5hbWV9KWA7XG4gICAgfSk7XG5cbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGA8aDQ+QWNjZXB0IHN3YXA8L2g0PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICAgICAgPHVsPlxuICAgICAgICAgICAgICAgICR7cHJpY2VMSX1cbiAgICAgICAgICAgICAgICA8bGk+WW91J2xsIHJlY2VpdmUgYXNzZXQke1xuICAgICAgICAgICAgICAgICAgYXNzZXRMaXN0Lmxlbmd0aCA+IDEgPyBcInNcIiA6IFwiXCJcbiAgICAgICAgICAgICAgICB9ICR7YXNzZXRMaXN0LmpvaW4oXCIsIFwiKX08L2xpPlxuICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTYgXCI+XG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCJkZWZhdWx0LnBuZ1wiIGlkPVwiaW1nQXNzZXRQcmV2aWV3XCIgY2xhc3M9XCJpbWctZmx1aWRcIj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGZvcm0+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItMyBmb3JtLWNoZWNrXCI+XG4gICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwiZm9ybS1jaGVjay1pbnB1dFwiIGlkPVwiY2hlY2tBY2NlcHRSaXNrXCIgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwiZm9ybS1jaGVjay1sYWJlbFwiIGZvcj1cImNoZWNrQWNjZXB0Umlza1wiPkkgYWNjZXB0IHRvIHVzZSB0aGlzIHRvb2wgYXQgbXkgb3duXG4gICAgICAgICAgICAgICAgICAgIHJpc2s8L2xhYmVsPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiYnRuIGJ0bi1nZW5lcmF0ZSBmdy1ib2xkXCIgaWQ9XCJidXR0b25BY2NlcHRcIj5BY2NlcHQgJiBzaWduPC9idXR0b24+XG4gICAgICAgIDwvZm9ybT5gO1xuXG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLnN1Ym1pdEFjY2VwdC5iaW5kKHRoaXMpKTtcblxuICAgIGlmICh0cmFuc2FjdGlvbnMucm95YWx0aWVzUGF5bWVudCkge1xuICAgICAgY29uc3QgbGlzdFByZXZpZXcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKTtcbiAgICAgIGNvbnN0IHJveWFsdGllc1BvaW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuXG4gICAgICBsZXQgcm95YWx0aWVzQW1vdW50ID0gdHJhbnNhY3Rpb25zLnJveWFsdGllc1BheW1lbnQuYW1vdW50O1xuICAgICAgbGV0IGN1cnJlbmN5O1xuXG4gICAgICBpZiAodHJhbnNhY3Rpb25zLnJveWFsdGllc1BheW1lbnQudHlwZSA9PT0gXCJwYXlcIikge1xuICAgICAgICAvL2NvbnZlcnQgbWljcm9hbGdvIHRvIGFsZ29cbiAgICAgICAgcm95YWx0aWVzQW1vdW50ID0gcm95YWx0aWVzQW1vdW50IC8gMTAwMDAwMDtcbiAgICAgICAgY3VycmVuY3kgPSBcIkFMR09cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbmN5ID0gdHJhbnNhY3Rpb25zLnJveWFsdGllc1BheW1lbnQuYXNzZXRJbmRleDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY3JlYXRvckFkZHJlc3MgPSBhbGdvc2RrLmVuY29kZUFkZHJlc3MoXG4gICAgICAgIHRyYW5zYWN0aW9ucy5yb3lhbHRpZXNQYXltZW50LnRvLnB1YmxpY0tleVxuICAgICAgKTtcblxuICAgICAgcm95YWx0aWVzUG9pbnQuaW5uZXJIVE1MID0gYFlvdSdsbCBzZW5kIDxzcGFuIGNsYXNzPVwicHJpY2VcIj4ke3JveWFsdGllc0Ftb3VudH0gJHtjdXJyZW5jeX08L3NwYW4+IHRvIGFzc2V0J3MgY3JlYXRvciAmIzEyODE1NDs8YnI+XG4gICAgICA8c3BhbiBjbGFzcz1cIndhbGxldC1pbmZvXCI+VE8gJHtjcmVhdG9yQWRkcmVzc308L3NwYW4+YDtcblxuICAgICAgbGlzdFByZXZpZXcuYXBwZW5kKHJveWFsdGllc1BvaW50KTtcbiAgICB9XG5cbiAgICAvL2xvYWQgYXNzZXQgaW1hemdlXG4gICAgbG9hZEFzc2V0SW1hZ2UoYXNzZXRJZHNbMF0sIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbWdBc3NldFByZXZpZXdcIiksIDUxMik7XG4gIH1cblxuICBhc3luYyBzdWJtaXRBY2NlcHQoZXZlbnQpIHtcbiAgICAvL2NhbmNlbCBkZWZhdWx0IGJlaGF2aW91ciB3aGVuIHN1Ym1pdGluZyBhIGZvcm1cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgY29uc3QgYnV0dG9uQWNjZXB0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbkFjY2VwdFwiKTtcbiAgICBidXR0b25BY2NlcHQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGJ1dHRvbkFjY2VwdC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgV2FpdGluZyBmb3Igc2lnbmF0dXJlcy4uLmA7XG5cbiAgICAvKmlmICh0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0VHlwZSA9PT0gXCJwZXJhXCIpIHtcbiAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNzaWduLWluZm9cIikuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0IGFsZXJ0LXByaW1hcnkgZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlclwiIHJvbGU9XCJhbGVydFwiPlxuICAgICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBjbGFzcz1cImJpIGJpLXBob25lXCIgdmlld0JveD1cIjAgMCAxNiAxNlwiPlxuICAgICAgICAgIDxwYXRoIGQ9XCJNMTEgMWExIDEgMCAwIDEgMSAxdjEyYTEgMSAwIDAgMS0xIDFINWExIDEgMCAwIDEtMS0xVjJhMSAxIDAgMCAxIDEtMWg2ek01IDBhMiAyIDAgMCAwLTIgMnYxMmEyIDIgMCAwIDAgMiAyaDZhMiAyIDAgMCAwIDItMlYyYTIgMiAwIDAgMC0yLTJINXpcIi8+XG4gICAgICAgICAgPHBhdGggZD1cIk04IDE0YTEgMSAwIDEgMCAwLTIgMSAxIDAgMCAwIDAgMnpcIi8+XG4gICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgUGxlYXNlIG9wZW4geW91ciBQZXJhIEFsZ28gV2FsbGV0IGFwcCB0byBzaWduLlxuICAgICAgPC9kaXY+YDtcbiAgICB9Ki9cblxuICAgIHRoaXMuc3dhcExpbmtNYW5hZ2VyLnNpZ25BbmRDb21taXRUcmFuc2FjdGlvbnMoXG4gICAgICB0aGlzLnNpZ25lZFRyYW5zZmVyVHhzLFxuICAgICAgdGhpcy5zaWduZWRPcHRpbkN1cnJlbmN5VHgsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vc2lnbmVkXG4gICAgICAgIC8vdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3NpZ24taW5mb1wiKS50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgICBidXR0b25BY2NlcHQuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPlxuICAgICAgICBTZW5kaW5nIHRyYW5zYWN0aW9ucy4uLmA7XG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvL3N1Y2Nlc3NcbiAgICAgICAgYnV0dG9uQWNjZXB0LmhpZGRlbiA9IHRydWU7XG5cbiAgICAgICAgY29uc3QgYXNzZXRMaXN0ID0gdGhpcy5zd2FwTGlua01hbmFnZXIuYXNzZXRzLm1hcCgoYXNzZXQpID0+IHtcbiAgICAgICAgICByZXR1cm4gYDxhIGhyZWY9XCJodHRwczovL3d3dy5uZnRleHBsb3Jlci5hcHAvYXNzZXQvJHthc3NldC5pbmRleH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke2Fzc2V0LmluZGV4fTwvYT4gKCR7YXNzZXQucGFyYW1zLm5hbWV9KWA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5Td2FwcGVkIPCfpbM8L2g0PlxuICAgICAgICBZb3UgcmVjZWl2ZWQgYXNzZXQke2Fzc2V0TGlzdC5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwifSAke2Fzc2V0TGlzdC5qb2luKCcsICcpfS5gO1xuICAgICAgfSxcbiAgICAgIChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuXG4gICAgICAgIC8vZmFpbGVkXG4gICAgICAgIGJ1dHRvbkFjY2VwdC5oaWRkZW4gPSB0cnVlO1xuXG4gICAgICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5BY2NlcHQgc3dhcDwvaDQ+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCIgcm9sZT1cImFsZXJ0XCI+RXJyb3I6PGJyPiR7ZXJyfTwvZGl2PmA7XG4gICAgICB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlN3YXBMaW5rQWNjZXB0IiwiY29uc3RydWN0b3IiLCJzd2FwRGF0YSIsIndhbGxldENvbm5lY3QiLCJhbGdvZENsaWVudCIsImFsZ29JbmRleGVyIiwidGhpcyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiZmllbGRzIiwic2lnbmVkVHJhbnNmZXJUeHMiLCJzaWduZWRPcHRpbkN1cnJlbmN5VHgiLCJyZXNvbHZlRGF0YSIsImFzeW5jIiwiZGVjb2RlZERhdGEiLCJhdG9iIiwianNvbkRhdGEiLCJKU09OIiwicGFyc2UiLCJjb25zb2xlIiwibG9nIiwibWFwIiwidHgiLCJkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zIiwiYXNzZXRJZHMiLCJ0eG4iLCJhc3NldEluZGV4Iiwic2VsbGVyQWRkcmVzcyIsImZyb20iLCJwdWJsaWNLZXkiLCJidXllckFkZHJlc3MiLCJ0byIsInByaWNlIiwiY3VycmVuY3kiLCJyb3lhbHRpZXMiLCJncm91cElEIiwiZ3JvdXAiLCJmaXJzdFJvdW5kIiwibGFzdFJvdW5kIiwic3RhdHVzIiwiZG8iLCJpbm5lckhUTUwiLCJ3YWxsZXRBZGRyZXNzIiwic3dhcExpbmtNYW5hZ2VyIiwiZ2VuZXJhdGVUcmFuc2FjdGlvbnMiLCJlcnIiLCJtZXNzYWdlIiwiZGlzcGxheVVJIiwidHJhbnNhY3Rpb25zIiwiYXNzZXRUcmFuc2ZlcnMiLCJwcmljZUxJIiwicGF5bWVudCIsImN1cnJlbmN5U3RyaW5nIiwiYW1vdW50IiwidHlwZSIsImVtb2ppIiwiY3VycmVuY3lBc3NldCIsImluZGV4IiwicGFyYW1zIiwiYXNzZXRMaXN0IiwiYXNzZXRzIiwiYXNzZXQiLCJuYW1lIiwibGVuZ3RoIiwiam9pbiIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0QWNjZXB0IiwiYmluZCIsInJveWFsdGllc1BheW1lbnQiLCJsaXN0UHJldmlldyIsInJveWFsdGllc1BvaW50Iiwicm95YWx0aWVzQW1vdW50IiwiY3JlYXRvckFkZHJlc3MiLCJhcHBlbmQiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiYnV0dG9uQWNjZXB0IiwiZGlzYWJsZWQiLCJzaWduQW5kQ29tbWl0VHJhbnNhY3Rpb25zIiwiaGlkZGVuIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9