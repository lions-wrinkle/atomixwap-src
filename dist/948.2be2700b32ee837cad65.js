"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[948],{1948:(e,t,s)=>{s.r(t),s.d(t,{SwapLinkForm:()=>l});var i=s(4050),a=s.n(i),r=s(2592),n=s(9182);class l{constructor(e,t,s,i,a){this.ui=document.createElement("div"),this.defaultRoyalties=t,this.submitCallback=s,this.walletConnect=i,this.algoIndexer=a,this.data={},this.isAssetCreator=!1,this.numNfts=0,this.ndfWalletAddress,this.ui.innerHTML=`<h4>Create swap link</h4>\n        <form>\n                    <div class="mb-3" id="nfts">\n                    </div>\n                    <div class="mb-3">\n                        <label for="inputAlgoAddress" class="form-label">Receiver</label>\n                        <input type="text" class="form-control" id="inputAlgoAddress"\n                            aria-describedby="AlgoAddressdHelp" required>\n                        <div id="AlgoAddressdHelp" class="form-text">Algorand Wallet Address or NFD</div>\n                    </div>\n                    <div class="mb-3">\n                        <div class="row">\n                        <label for="inputPrice" class="form-label" id="price-label">Price</label>\n                        <label for="inputPriceAssetId" class="form-label" id="nft-label" hidden>NFT to receive</label>\n                            <div class="col" id="price-div">\n                                <input type="number" class="form-control" id="inputPrice" min="0" step="1">\n                            </div>\n                            <div class="col" id="nft-div" hidden>\n                                <input type="text" class="form-control" id="inputPriceAssetId" aria-describedby="priceAssetIdHelp"\n                                    pattern="\\d*">\n                                <div id="priceAssetIdHelp" class="form-text">ASA asset ID</div>\n                            </div>\n                            <div class="col">\n                                <select class="form-select" id="inputCurrency" aria-label="Select currency">\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="mb-3">\n                      <div class="row">\n                        <div class="col-6">\n                          <div class="d-flex justify-content-between">\n                          <label for="inputRoyalties" class="form-label">Creator royalty</label>\n                          <span id="royaltiesValueLabel" class="royalties">0&percnt;</span>\n                      </div>\n\n                      <input type="range" class="form-range" value="${this.defaultRoyalties}" min="0" max="10" step="0.5" id="inputRoyalties"\n                          aria-describedby="royaltiesdHelp">\n                      <div id="royaltiesdHelp" class="form-text"></div>\n                        </div>\n                        <div class="col-6 position-relative">\n                        <span class="position-absolute heart" id="royaltiesLoveRed" hidden>&#10084;</span>\n                        <span class="position-absolute heart" id="royaltiesLoveGreen">&#128154;</span>\n                        \n                        </div>\n                      </div>\n                       \n                    </div>\n                    <div class="mb-3 form-check">\n                        <input type="checkbox" class="form-check-input" id="checkAcceptRisk" required>\n                        <label class="form-check-label" for="checkAcceptRisk">I accept to use this tool at my own\n                            risk</label>\n                    </div>\n                    <button type="submit" id="buttonSubmit" class="btn btn-generate fw-bold">Preview</button>\n\n\n                </form>`,this.addNFT();const r=this.ui.querySelector("#inputCurrency"),n=document.createElement("option");n.textContent="ALGO",n.value="algo",n.selected=!0,r.append(n);const l=document.createElement("option");l.textContent="NFT",l.value="nft",r.append(l);const o=document.createElement("optgroup");o.label="ASAs",r.append(o);for(const t of e){const e=document.createElement("option");e.textContent=t.name,e.value=t.assetId,o.append(e)}this.ui.querySelector("#inputRoyalties").addEventListener("input",this.royaltiesChange.bind(this),!1),this.ui.querySelector("#inputCurrency").addEventListener("change",this.currencyChange.bind(this),!1),this.ui.querySelector("form").addEventListener("submit",this.submitForm.bind(this),!1),this.ui.querySelector("#inputAlgoAddress").addEventListener("focusout",this.checkNfd.bind(this),!1),this.ui.querySelector("#inputRoyalties").dispatchEvent(new Event("input"))}addNFT(e){if(e&&e.currentTarget&&(e.currentTarget.hidden=!0),this.numNfts>=n.Z.maxNfts)return;const t=this.ui.querySelector("#nfts"),s=document.createElement("div");s.className="row mt-2",s.innerHTML=`\n      <div class="col-6">\n        <label for="inputAssetId" class="form-label">NFT</label>\n        <input type="text" class="form-control" id="inputAssetId" data-id="${this.numNfts}" aria-describedby="assetIdHelp"\n            pattern="\\d*">\n        <div id="assetIdHelp" class="form-text">ASA asset ID</div>\n      </div>\n      <div class="col-1">\n        <br>\n        <a href="javascript:void(0);" id="add-nft" hidden>\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-square mt-3" viewBox="0 0 16 16">\n            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>\n          </svg>\n        </a>\n      </div>\n      <div class="col-5 text-center">\n        <img src="default.png" id="imgAssetPreview" width="auto" height="95">\n      </div>\n    `;const i=s.querySelector("#inputAssetId");0===this.numNfts&&(i.required=!0),i.addEventListener("focusout",this.assetIdFocusOut.bind(this),!1);const a=s.querySelector("#add-nft");this.numNfts<n.Z.maxNfts-1&&(a.hidden=!1,a.addEventListener("click",this.addNFT.bind(this),!1)),t.append(s),this.numNfts++}async assetIdFocusOut(e){const t=e.currentTarget;this.displayAssetInfo(t)}async displayAssetInfo(e){const t=e.parentNode.parentNode,s=t.querySelector("#assetIdHelp"),i=t.querySelector("#imgAssetPreview"),a=this.ui.querySelector("#inputRoyalties"),n=this.ui.querySelector("#royaltiesdHelp"),l=parseInt(e.value);if(isNaN(l))s.innerHTML='<span class="text-danger">Wrong asset ID format</span>',a.disabled=!1,n.textContent="";else{try{const e=await this.algoIndexer.lookupAssetByID(l).do();s.innerHTML=`<span class="text-success">${e.asset.params.name} (${e.asset.params["unit-name"]})</span>`,e.asset.params.creator===this.walletConnect.walletAddress?this.isAssetCreator=!0:this.isAssetCreator=!1}catch(e){console.log(e),s.innerHTML=`<span class="text-danger">Error: Asset with ID ${l} not found</span>`,this.isAssetCreator=!1}this.checkRoyaltiesAvailability(),(0,r.g)(l,i,200)}}async checkNfd(e){const t=e.currentTarget.value,s=this.ui.querySelector("#AlgoAddressdHelp");if(this.ndfWalletAddress=void 0,t.endsWith(".algo"))try{const e=await fetch("https://api.nf.domains/nfd/"+t);if(200===e.status){const t=await e.json();t.owner&&(s.innerHTML=`<span class="text-success">${t.owner}</span>`,this.ndfWalletAddress=t.owner)}else s.innerHTML=`<span class="text-danger">Error: NFD ${t} not found</span>`}catch(e){console.error(e),s.innerHTML='<span class="text-danger">Error: Can\'t load NFD</span>'}else a().isValidAddress(t)?s.textContent="Algorand Wallet Address or NFD":s.innerHTML='<span class="text-danger">Wrong wallet address format</span>'}currencyChange(e){const t=e.currentTarget.value,s=this.ui.querySelector("#nft-div"),i=this.ui.querySelector("#nft-label"),a=this.ui.querySelector("#price-div"),r=this.ui.querySelector("#price-label");"nft"===t?(s.hidden=!1,i.hidden=!1,s.querySelector("input").required=!0,a.hidden=!0,r.hidden=!0,a.querySelector("input").required=!1):(s.hidden=!0,i.hidden=!0,s.querySelector("input").required=!1,a.hidden=!1,r.hidden=!1,a.querySelector("input").required=!0),this.checkRoyaltiesAvailability()}async checkRoyaltiesAvailability(){const e=this.ui.querySelector("#inputCurrency"),t=this.ui.querySelector("#inputRoyalties"),s=this.ui.querySelector("#royaltiesdHelp"),i=this.ui.querySelector("#royaltiesLoveGreen"),a=this.ui.querySelector("#royaltiesLoveRed");let r=!1;if(this.numNfts>1){let e="";console.log("--");for(const t of this.ui.querySelectorAll("#inputAssetId"))if(t.value&&!isNaN(t.value))try{const s=await this.algoIndexer.lookupAssetByID(parseInt(t.value)).do();console.log(s.asset.params.creator),e&&e!=s.asset.params.creator&&(r=!0),e=s.asset.params.creator}catch(e){console.error(e)}}console.log(r),"algo"!==e.value||this.isAssetCreator||r?(t.value=0,t.disabled=!0,"algo"!==e.value?s.textContent="Royalty not available for other token than Algo":this.isAssetCreator?s.textContent="You're the creator of this asset, royalty disabled.":r&&(s.textContent="Multiple creators detected, royalty disabled."),i.hidden=!0,a.hidden=!0):(t.disabled=!1,s.textContent="",i.hidden=!1),t.dispatchEvent(new Event("input"))}royaltiesChange(e){const t=this.ui.querySelector("#inputRoyalties");this.ui.querySelector("#royaltiesValueLabel").textContent=`${t.value} %`;const s=this.ui.querySelector("#royaltiesLoveGreen"),i=this.ui.querySelector("#royaltiesLoveRed"),a=Number(t.min),r=Number(t.max),n=1+(t.value-t.min)/(t.max-t.min)*3.5;if(s.style=`font-size: ${n}rem`,t.value>a+(r-a)/2){const e=(t.value-(a+(r-a)/2))/((r-a)/2);let l="";t.value===t.max&&(l="animation: animateHeart 1.2s infinite;"),i.hidden=!1,i.style=`font-size: ${n}rem; ${l}`,s.style=`font-size: ${n}rem; opacity: ${1-e}`}else i.hidden=!0}async validate(){await this.checkRoyaltiesAvailability();const e=[];if(this.ui.querySelectorAll("#inputAssetId").forEach((async t=>{if(t.value&&!isNaN(t.value))e.push(parseInt(t.value,10)),await this.displayAssetInfo(t);else if(t.value&&isNaN(t.value))throw new Error(`Wrong format for asset id ${t.value}`)})),this.data.assetIds=e,this.data.buyerAddress=this.ui.querySelector("#inputAlgoAddress").value,this.data.price=this.ui.querySelector("#inputPrice").value,this.data.currency=this.ui.querySelector("#inputCurrency").value,this.data.royaltiesPercent=this.ui.querySelector("#inputRoyalties").value,this.data.acceptRisk=this.ui.querySelector("#checkAcceptRisk").checked,0===this.data.assetIds.length)throw new Error("No asset id provided or wrong format");if(this.data.buyerAddress.endsWith(".algo")&&!this.ndfWalletAddress)throw new Error("NFD not found");if(!this.data.buyerAddress.endsWith(".algo")&&!a().isValidAddress(this.data.buyerAddress))throw new Error("Algorand wallet address is not valid");if(isNaN(this.data.price))throw new Error("Price is not a number");if(isNaN(this.data.royaltiesPercent))throw new Error("Royalties value is not a number");if(!this.data.acceptRisk)throw new Error("Risk not accepted");if("nft"===this.data.currency&&isNaN(this.ui.querySelector("#inputPriceAssetId").value))throw new Error(`Wrong format for asset id ${this.ui.querySelector("#inputPriceAssetId").value}`);this.data.buyerAddress.endsWith(".algo")&&(this.data.buyerAddress=this.ndfWalletAddress),this.data.priceAssetId=parseInt(this.ui.querySelector("#inputPriceAssetId").value)}async submitForm(e){e.preventDefault();try{await this.validate()}catch(e){return void alert(e)}this.submitCallback&&this.submitCallback(this)}makeBusy(){const e=this.ui.querySelector("#buttonSubmit");e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n    Preview'}stopBusy(){const e=this.ui.querySelector("#buttonSubmit");e.textContent="Preview",e.disabled=!1}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c3JjL3N3YXAtbGluay1mb3JtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbGdvc2RrIGZyb20gXCJhbGdvc2RrXCI7XG5pbXBvcnQgeyBsb2FkQXNzZXRJbWFnZSB9IGZyb20gXCIuL2Fzc2V0LWRldGFpbHNcIjtcbmltcG9ydCBjb25maWcgZnJvbSBcIi4vY29uZmlnLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBTd2FwTGlua0Zvcm0ge1xuICBjb25zdHJ1Y3RvcihcbiAgICBjdXJyZW5jaWVzLFxuICAgIGRlZmF1bHRSb3lhbHRpZXMsXG4gICAgc3VibWl0Q2FsbGJhY2ssXG4gICAgd2FsbGV0Q29ubmVjdCxcbiAgICBhbGdvSW5kZXhlclxuICApIHtcbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLmRlZmF1bHRSb3lhbHRpZXMgPSBkZWZhdWx0Um95YWx0aWVzO1xuICAgIHRoaXMuc3VibWl0Q2FsbGJhY2sgPSBzdWJtaXRDYWxsYmFjaztcbiAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gZmFsc2U7XG4gICAgdGhpcy5udW1OZnRzID0gMDtcbiAgICB0aGlzLm5kZldhbGxldEFkZHJlc3M7XG5cbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGA8aDQ+Q3JlYXRlIHN3YXAgbGluazwvaDQ+XG4gICAgICAgIDxmb3JtPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiIGlkPVwibmZ0c1wiPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJpbnB1dEFsZ29BZGRyZXNzXCIgY2xhc3M9XCJmb3JtLWxhYmVsXCI+UmVjZWl2ZXI8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cImlucHV0QWxnb0FkZHJlc3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9XCJBbGdvQWRkcmVzc2RIZWxwXCIgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwiQWxnb0FkZHJlc3NkSGVscFwiIGNsYXNzPVwiZm9ybS10ZXh0XCI+QWxnb3JhbmQgV2FsbGV0IEFkZHJlc3Mgb3IgTkZEPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0UHJpY2VcIiBjbGFzcz1cImZvcm0tbGFiZWxcIiBpZD1cInByaWNlLWxhYmVsXCI+UHJpY2U8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0UHJpY2VBc3NldElkXCIgY2xhc3M9XCJmb3JtLWxhYmVsXCIgaWQ9XCJuZnQtbGFiZWxcIiBoaWRkZW4+TkZUIHRvIHJlY2VpdmU8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2xcIiBpZD1cInByaWNlLWRpdlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cIm51bWJlclwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJpbnB1dFByaWNlXCIgbWluPVwiMFwiIHN0ZXA9XCIxXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbFwiIGlkPVwibmZ0LWRpdlwiIGhpZGRlbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cImlucHV0UHJpY2VBc3NldElkXCIgYXJpYS1kZXNjcmliZWRieT1cInByaWNlQXNzZXRJZEhlbHBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybj1cIlxcXFxkKlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwicHJpY2VBc3NldElkSGVscFwiIGNsYXNzPVwiZm9ybS10ZXh0XCI+QVNBIGFzc2V0IElEPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzPVwiZm9ybS1zZWxlY3RcIiBpZD1cImlucHV0Q3VycmVuY3lcIiBhcmlhLWxhYmVsPVwiU2VsZWN0IGN1cnJlbmN5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiPlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJpbnB1dFJveWFsdGllc1wiIGNsYXNzPVwiZm9ybS1sYWJlbFwiPkNyZWF0b3Igcm95YWx0eTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPVwicm95YWx0aWVzVmFsdWVMYWJlbFwiIGNsYXNzPVwicm95YWx0aWVzXCI+MCZwZXJjbnQ7PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJyYW5nZVwiIGNsYXNzPVwiZm9ybS1yYW5nZVwiIHZhbHVlPVwiJHt0aGlzLmRlZmF1bHRSb3lhbHRpZXN9XCIgbWluPVwiMFwiIG1heD1cIjEwXCIgc3RlcD1cIjAuNVwiIGlkPVwiaW5wdXRSb3lhbHRpZXNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhLWRlc2NyaWJlZGJ5PVwicm95YWx0aWVzZEhlbHBcIj5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwicm95YWx0aWVzZEhlbHBcIiBjbGFzcz1cImZvcm0tdGV4dFwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLTYgcG9zaXRpb24tcmVsYXRpdmVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicG9zaXRpb24tYWJzb2x1dGUgaGVhcnRcIiBpZD1cInJveWFsdGllc0xvdmVSZWRcIiBoaWRkZW4+JiMxMDA4NDs8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInBvc2l0aW9uLWFic29sdXRlIGhlYXJ0XCIgaWQ9XCJyb3lhbHRpZXNMb3ZlR3JlZW5cIj4mIzEyODE1NDs8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zIGZvcm0tY2hlY2tcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjbGFzcz1cImZvcm0tY2hlY2staW5wdXRcIiBpZD1cImNoZWNrQWNjZXB0Umlza1wiIHJlcXVpcmVkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwiZm9ybS1jaGVjay1sYWJlbFwiIGZvcj1cImNoZWNrQWNjZXB0Umlza1wiPkkgYWNjZXB0IHRvIHVzZSB0aGlzIHRvb2wgYXQgbXkgb3duXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlzazwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBpZD1cImJ1dHRvblN1Ym1pdFwiIGNsYXNzPVwiYnRuIGJ0bi1nZW5lcmF0ZSBmdy1ib2xkXCI+UHJldmlldzwvYnV0dG9uPlxuXG5cbiAgICAgICAgICAgICAgICA8L2Zvcm0+YDtcblxuICAgIC8vYWRkIG5mdCBmb3JtXG4gICAgdGhpcy5hZGRORlQoKTtcblxuICAgIC8vYWRkIGN1cnJlbmNpZXNcbiAgICBjb25zdCBpbnB1dEN1cnJlbmN5ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Q3VycmVuY3lcIik7XG5cbiAgICAvL2FkZCBhbGdvIGJ5IGRlZmF1bHRcbiAgICBjb25zdCBhbGdvT3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBhbGdvT3B0aW9uLnRleHRDb250ZW50ID0gXCJBTEdPXCI7XG4gICAgYWxnb09wdGlvbi52YWx1ZSA9IFwiYWxnb1wiO1xuICAgIGFsZ29PcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuXG4gICAgaW5wdXRDdXJyZW5jeS5hcHBlbmQoYWxnb09wdGlvbik7XG5cbiAgICAvL2FkZCBuZnQgb3B0aW9uXG4gICAgY29uc3QgbmZ0T3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBuZnRPcHRpb24udGV4dENvbnRlbnQgPSBcIk5GVFwiO1xuICAgIG5mdE9wdGlvbi52YWx1ZSA9IFwibmZ0XCI7XG5cbiAgICBpbnB1dEN1cnJlbmN5LmFwcGVuZChuZnRPcHRpb24pO1xuXG4gICAgLy9hZGQgYXNhIG9wdGlvblxuICAgIGNvbnN0IGFzYU9wdEdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGdyb3VwXCIpO1xuICAgIGFzYU9wdEdyb3VwLmxhYmVsID0gXCJBU0FzXCI7XG4gICAgaW5wdXRDdXJyZW5jeS5hcHBlbmQoYXNhT3B0R3JvdXApO1xuXG4gICAgZm9yIChjb25zdCBjdXJyZW5jeSBvZiBjdXJyZW5jaWVzKSB7XG4gICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gY3VycmVuY3kubmFtZTtcbiAgICAgIG9wdGlvbi52YWx1ZSA9IGN1cnJlbmN5LmFzc2V0SWQ7XG4gICAgICBhc2FPcHRHcm91cC5hcHBlbmQob3B0aW9uKTtcbiAgICB9XG5cbiAgICAvL2xpc3RlbiB0byBjaGFuZ2UgZXZlbnRzXG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgdGhpcy5yb3lhbHRpZXNDaGFuZ2UuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRDdXJyZW5jeVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgdGhpcy5jdXJyZW5jeUNoYW5nZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAvL2xpc3RlbiB0byBmb3JtIHN1Ym1pdCBldmVudFxuICAgIHRoaXMudWlcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRGb3JtLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIC8vZmluZCBuZmRcbiAgICB0aGlzLnVpXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNpbnB1dEFsZ29BZGRyZXNzXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3Vzb3V0XCIsIHRoaXMuY2hlY2tOZmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgLy91cGRhdGUgcm95YWx0aWVzXG4gICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIikpO1xuICB9XG5cbiAgYWRkTkZUKGV2ZW50KSB7XG4gICAgLy9oaWRlICcrJyBidXR0b24gdGhhdCBoYXZlIGJlZW4ganVzdCBjbGlja2VkXG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50LmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQuaGlkZGVuID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5udW1OZnRzID49IGNvbmZpZy5tYXhOZnRzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbmZ0c0RpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNuZnRzXCIpO1xuXG4gICAgY29uc3QgbmV3TmZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBuZXdOZnQuY2xhc3NOYW1lID0gXCJyb3cgbXQtMlwiO1xuICAgIG5ld05mdC5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLTZcIj5cbiAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0QXNzZXRJZFwiIGNsYXNzPVwiZm9ybS1sYWJlbFwiPk5GVDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJpbnB1dEFzc2V0SWRcIiBkYXRhLWlkPVwiJHt0aGlzLm51bU5mdHN9XCIgYXJpYS1kZXNjcmliZWRieT1cImFzc2V0SWRIZWxwXCJcbiAgICAgICAgICAgIHBhdHRlcm49XCJcXFxcZCpcIj5cbiAgICAgICAgPGRpdiBpZD1cImFzc2V0SWRIZWxwXCIgY2xhc3M9XCJmb3JtLXRleHRcIj5BU0EgYXNzZXQgSUQ8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImNvbC0xXCI+XG4gICAgICAgIDxicj5cbiAgICAgICAgPGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKTtcIiBpZD1cImFkZC1uZnRcIiBoaWRkZW4+XG4gICAgICAgICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyNFwiIGhlaWdodD1cIjI0XCIgZmlsbD1cImN1cnJlbnRDb2xvclwiIGNsYXNzPVwiYmkgYmktcGx1cy1zcXVhcmUgbXQtM1wiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIj5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNMTQgMWExIDEgMCAwIDEgMSAxdjEyYTEgMSAwIDAgMS0xIDFIMmExIDEgMCAwIDEtMS0xVjJhMSAxIDAgMCAxIDEtMWgxMnpNMiAwYTIgMiAwIDAgMC0yIDJ2MTJhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjJhMiAyIDAgMCAwLTItMkgyelwiLz5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNOCA0YS41LjUgMCAwIDEgLjUuNXYzaDNhLjUuNSAwIDAgMSAwIDFoLTN2M2EuNS41IDAgMCAxLTEgMHYtM2gtM2EuNS41IDAgMCAxIDAtMWgzdi0zQS41LjUgMCAwIDEgOCA0elwiLz5cbiAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgPC9hPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLTUgdGV4dC1jZW50ZXJcIj5cbiAgICAgICAgPGltZyBzcmM9XCJkZWZhdWx0LnBuZ1wiIGlkPVwiaW1nQXNzZXRQcmV2aWV3XCIgd2lkdGg9XCJhdXRvXCIgaGVpZ2h0PVwiOTVcIj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICBjb25zdCBpbnB1dEFzc2V0SWQgPSBuZXdOZnQucXVlcnlTZWxlY3RvcihgI2lucHV0QXNzZXRJZGApO1xuXG4gICAgaWYgKHRoaXMubnVtTmZ0cyA9PT0gMCkge1xuICAgICAgaW5wdXRBc3NldElkLnJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpbnB1dEFzc2V0SWQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgIFwiZm9jdXNvdXRcIixcbiAgICAgIHRoaXMuYXNzZXRJZEZvY3VzT3V0LmJpbmQodGhpcyksXG4gICAgICBmYWxzZVxuICAgICk7XG5cbiAgICBjb25zdCBhZGRMaW5rID0gbmV3TmZ0LnF1ZXJ5U2VsZWN0b3IoYCNhZGQtbmZ0YCk7XG5cbiAgICBpZiAodGhpcy5udW1OZnRzIDwgY29uZmlnLm1heE5mdHMgLSAxKSB7XG4gICAgICBhZGRMaW5rLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgYWRkTGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5hZGRORlQuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIH1cblxuICAgIG5mdHNEaXYuYXBwZW5kKG5ld05mdCk7XG5cbiAgICB0aGlzLm51bU5mdHMrKztcbiAgfVxuXG4gIGFzeW5jIGFzc2V0SWRGb2N1c091dChldmVudCkge1xuICAgIGNvbnN0IGlucHV0QXNzZXRJZCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgdGhpcy5kaXNwbGF5QXNzZXRJbmZvKGlucHV0QXNzZXRJZCk7XG4gIH1cblxuICBhc3luYyBkaXNwbGF5QXNzZXRJbmZvKGlucHV0QXNzZXRJZCkge1xuICAgIGNvbnN0IHBhcmVudCA9IGlucHV0QXNzZXRJZC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG5cbiAgICBjb25zdCBhc3NldElkSGVscCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKFwiI2Fzc2V0SWRIZWxwXCIpO1xuICAgIGNvbnN0IGFzc2V0SW1nID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1nQXNzZXRQcmV2aWV3XCIpO1xuICAgIC8vY29uc3QgaW5wdXRBc3NldElkID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0QXNzZXRJZFwiKTtcbiAgICBjb25zdCBpbnB1dFJveWFsdGllcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFJveWFsdGllc1wiKTtcbiAgICBjb25zdCByb3lhbHRpZXNkSGVscCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNyb3lhbHRpZXNkSGVscFwiKTtcbiAgICBjb25zdCBhc3NldElEID0gcGFyc2VJbnQoaW5wdXRBc3NldElkLnZhbHVlKTtcblxuICAgIC8vcmV0cmVpdmUgYXNzZXQgaW5mb3NcbiAgICBpZiAoIWlzTmFOKGFzc2V0SUQpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyLmxvb2t1cEFzc2V0QnlJRChhc3NldElEKS5kbygpO1xuXG4gICAgICAgIGFzc2V0SWRIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtc3VjY2Vzc1wiPiR7cmVzdWx0LmFzc2V0LnBhcmFtcy5uYW1lfSAoJHtyZXN1bHQuYXNzZXQucGFyYW1zW1widW5pdC1uYW1lXCJdfSk8L3NwYW4+YDtcblxuICAgICAgICBjb25zdCBjcmVhdG9yQWRkcmVzcyA9IHJlc3VsdC5hc3NldC5wYXJhbXMuY3JlYXRvcjtcblxuICAgICAgICBpZiAoY3JlYXRvckFkZHJlc3MgPT09IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzKSB7XG4gICAgICAgICAgdGhpcy5pc0Fzc2V0Q3JlYXRvciA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5pc0Fzc2V0Q3JlYXRvciA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgYXNzZXRJZEhlbHAuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwidGV4dC1kYW5nZXJcIj5FcnJvcjogQXNzZXQgd2l0aCBJRCAke2Fzc2V0SUR9IG5vdCBmb3VuZDwvc3Bhbj5gO1xuXG4gICAgICAgIHRoaXMuaXNBc3NldENyZWF0b3IgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuXG4gICAgICAvL2xvYWQgYXNzZXQgaW1hemdlXG4gICAgICBsb2FkQXNzZXRJbWFnZShhc3NldElELCBhc3NldEltZywgMjAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXRJZEhlbHAuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwidGV4dC1kYW5nZXJcIj5Xcm9uZyBhc3NldCBJRCBmb3JtYXQ8L3NwYW4+YDtcblxuICAgICAgaW5wdXRSb3lhbHRpZXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjaGVja05mZChldmVudCkge1xuICAgIGNvbnN0IGFkZHJlc3MgPSBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlO1xuXG4gICAgY29uc3QgYWRkcmVzc0hlbHAgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjQWxnb0FkZHJlc3NkSGVscFwiKTtcblxuICAgIHRoaXMubmRmV2FsbGV0QWRkcmVzcyA9IHVuZGVmaW5lZDtcblxuICAgIGlmIChhZGRyZXNzLmVuZHNXaXRoKFwiLmFsZ29cIikpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCJodHRwczovL2FwaS5uZi5kb21haW5zL25mZC9cIiArIGFkZHJlc3MpO1xuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgaWYgKGpzb24ub3duZXIpIHtcbiAgICAgICAgICAgIGFkZHJlc3NIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtc3VjY2Vzc1wiPiR7anNvbi5vd25lcn08L3NwYW4+YDtcbiAgICAgICAgICAgIHRoaXMubmRmV2FsbGV0QWRkcmVzcyA9IGpzb24ub3duZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkZHJlc3NIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+RXJyb3I6IE5GRCAke2FkZHJlc3N9IG5vdCBmb3VuZDwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICBhZGRyZXNzSGVscC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJ0ZXh0LWRhbmdlclwiPkVycm9yOiBDYW4ndCBsb2FkIE5GRDwvc3Bhbj5gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIWFsZ29zZGsuaXNWYWxpZEFkZHJlc3MoYWRkcmVzcykpIHtcbiAgICAgIGFkZHJlc3NIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+V3Jvbmcgd2FsbGV0IGFkZHJlc3MgZm9ybWF0PC9zcGFuPmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFkZHJlc3NIZWxwLnRleHRDb250ZW50ID0gJ0FsZ29yYW5kIFdhbGxldCBBZGRyZXNzIG9yIE5GRCc7XG4gICAgfVxuICB9XG5cbiAgY3VycmVuY3lDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCBjdXJyZW5jeSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWU7XG5cbiAgICBjb25zdCBuZnRJbnB1dCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNuZnQtZGl2XCIpO1xuICAgIGNvbnN0IG5mdExhYmVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI25mdC1sYWJlbFwiKTtcbiAgICBjb25zdCBwcmljZUlucHV0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3ByaWNlLWRpdlwiKTtcbiAgICBjb25zdCBwcmljZUxhYmVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3ByaWNlLWxhYmVsXCIpO1xuXG4gICAgaWYgKGN1cnJlbmN5ID09PSBcIm5mdFwiKSB7XG4gICAgICBuZnRJbnB1dC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIG5mdExhYmVsLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgbmZ0SW5wdXQucXVlcnlTZWxlY3RvcihcImlucHV0XCIpLnJlcXVpcmVkID0gdHJ1ZTtcblxuICAgICAgcHJpY2VJbnB1dC5oaWRkZW4gPSB0cnVlO1xuICAgICAgcHJpY2VMYWJlbC5oaWRkZW4gPSB0cnVlO1xuICAgICAgcHJpY2VJbnB1dC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikucmVxdWlyZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmZ0SW5wdXQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIG5mdExhYmVsLmhpZGRlbiA9IHRydWU7XG4gICAgICBuZnRJbnB1dC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikucmVxdWlyZWQgPSBmYWxzZTtcblxuICAgICAgcHJpY2VJbnB1dC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIHByaWNlTGFiZWwuaGlkZGVuID0gZmFsc2U7XG4gICAgICBwcmljZUlucHV0LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKS5yZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuICB9XG5cbiAgYXN5bmMgY2hlY2tSb3lhbHRpZXNBdmFpbGFiaWxpdHkoKSB7XG4gICAgY29uc3QgaW5wdXRDdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpO1xuICAgIGNvbnN0IGlucHV0Um95YWx0aWVzID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpO1xuICAgIGNvbnN0IHJveWFsdGllc2RIZWxwID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc2RIZWxwXCIpO1xuICAgIGNvbnN0IGdyZWVuSGVhcnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzTG92ZUdyZWVuXCIpO1xuICAgIGNvbnN0IHJlZEhlYXJ0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc0xvdmVSZWRcIik7XG5cbiAgICAvL2lmIHRoZXJlIGlmIG11bHRpcGxlIGFzc2V0cywgY2hlY2sgaWYgdGhleSdyZSBmcm9tIG11bHRpcGxlIGNyZWF0b3JzXG4gICAgbGV0IG11bHRpcGxlQ3JlYXRvcnMgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLm51bU5mdHMgPiAxKSB7XG4gICAgICBjb25zdCBhc3NldElkcyA9IFtdO1xuXG4gICAgICBsZXQgcHJldkNyZWF0b3IgPSBcIlwiO1xuICAgICAgY29uc29sZS5sb2coXCItLVwiKTtcbiAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjaW5wdXRBc3NldElkXCIpKSB7XG4gICAgICAgIGlmIChlLnZhbHVlICYmICFpc05hTihlLnZhbHVlKSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAgICAgICAgIC5sb29rdXBBc3NldEJ5SUQocGFyc2VJbnQoZS52YWx1ZSkpXG4gICAgICAgICAgICAgIC5kbygpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0LmFzc2V0LnBhcmFtcy5jcmVhdG9yKTtcbiAgICAgICAgICAgIGlmIChwcmV2Q3JlYXRvciAmJiBwcmV2Q3JlYXRvciAhPSByZXN1bHQuYXNzZXQucGFyYW1zLmNyZWF0b3IpIHtcbiAgICAgICAgICAgICAgbXVsdGlwbGVDcmVhdG9ycyA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHByZXZDcmVhdG9yID0gcmVzdWx0LmFzc2V0LnBhcmFtcy5jcmVhdG9yO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKG11bHRpcGxlQ3JlYXRvcnMpO1xuXG4gICAgaWYgKFxuICAgICAgaW5wdXRDdXJyZW5jeS52YWx1ZSAhPT0gXCJhbGdvXCIgfHxcbiAgICAgIHRoaXMuaXNBc3NldENyZWF0b3IgfHxcbiAgICAgIG11bHRpcGxlQ3JlYXRvcnNcbiAgICApIHtcbiAgICAgIGlucHV0Um95YWx0aWVzLnZhbHVlID0gMDtcbiAgICAgIGlucHV0Um95YWx0aWVzLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgaWYgKGlucHV0Q3VycmVuY3kudmFsdWUgIT09IFwiYWxnb1wiKSB7XG4gICAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIlJveWFsdHkgbm90IGF2YWlsYWJsZSBmb3Igb3RoZXIgdG9rZW4gdGhhbiBBbGdvXCI7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNBc3NldENyZWF0b3IpIHtcbiAgICAgICAgcm95YWx0aWVzZEhlbHAudGV4dENvbnRlbnQgPVxuICAgICAgICAgIFwiWW91J3JlIHRoZSBjcmVhdG9yIG9mIHRoaXMgYXNzZXQsIHJveWFsdHkgZGlzYWJsZWQuXCI7XG4gICAgICB9IGVsc2UgaWYgKG11bHRpcGxlQ3JlYXRvcnMpIHtcbiAgICAgICAgcm95YWx0aWVzZEhlbHAudGV4dENvbnRlbnQgPVxuICAgICAgICAgIFwiTXVsdGlwbGUgY3JlYXRvcnMgZGV0ZWN0ZWQsIHJveWFsdHkgZGlzYWJsZWQuXCI7XG4gICAgICB9XG5cbiAgICAgIGdyZWVuSGVhcnQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIHJlZEhlYXJ0LmhpZGRlbiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vaW5wdXRSb3lhbHRpZXMudmFsdWUgPSB0aGlzLmRlZmF1bHRSb3lhbHRpZXM7XG4gICAgICBpbnB1dFJveWFsdGllcy5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgcm95YWx0aWVzZEhlbHAudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgZ3JlZW5IZWFydC5oaWRkZW4gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpbnB1dFJveWFsdGllcy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImlucHV0XCIpKTtcbiAgfVxuXG4gIHJveWFsdGllc0NoYW5nZShldmVudCkge1xuICAgIGNvbnN0IHJveWFsdGllc1NsaWRlciA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFJveWFsdGllc1wiKTtcblxuICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiI3JveWFsdGllc1ZhbHVlTGFiZWxcIlxuICAgICkudGV4dENvbnRlbnQgPSBgJHtyb3lhbHRpZXNTbGlkZXIudmFsdWV9ICVgO1xuXG4gICAgY29uc3QgZ3JlZW5IZWFydCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNyb3lhbHRpZXNMb3ZlR3JlZW5cIik7XG4gICAgY29uc3QgcmVkSGVhcnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzTG92ZVJlZFwiKTtcblxuICAgIGNvbnN0IG1pbkZvbnRTaXplID0gMS4wO1xuICAgIGNvbnN0IG1heEZvbnRTaXplID0gNC41O1xuICAgIGNvbnN0IHNsaWRlck1pbiA9IE51bWJlcihyb3lhbHRpZXNTbGlkZXIubWluKTtcbiAgICBjb25zdCBzbGlkZXJNYXggPSBOdW1iZXIocm95YWx0aWVzU2xpZGVyLm1heCk7XG5cbiAgICBjb25zdCBmb250U2l6ZSA9XG4gICAgICBtaW5Gb250U2l6ZSArXG4gICAgICAobWF4Rm9udFNpemUgLSBtaW5Gb250U2l6ZSkgKlxuICAgICAgICAoKHJveWFsdGllc1NsaWRlci52YWx1ZSAtIHJveWFsdGllc1NsaWRlci5taW4pIC9cbiAgICAgICAgICAocm95YWx0aWVzU2xpZGVyLm1heCAtIHJveWFsdGllc1NsaWRlci5taW4pKTtcblxuICAgIGdyZWVuSGVhcnQuc3R5bGUgPSBgZm9udC1zaXplOiAke2ZvbnRTaXplfXJlbWA7XG5cbiAgICBpZiAocm95YWx0aWVzU2xpZGVyLnZhbHVlID4gc2xpZGVyTWluICsgKHNsaWRlck1heCAtIHNsaWRlck1pbikgLyAyKSB7XG4gICAgICBjb25zdCByZWRIZWFydE9wYWNpdHkgPVxuICAgICAgICAocm95YWx0aWVzU2xpZGVyLnZhbHVlIC0gKHNsaWRlck1pbiArIChzbGlkZXJNYXggLSBzbGlkZXJNaW4pIC8gMikpIC9cbiAgICAgICAgKChzbGlkZXJNYXggLSBzbGlkZXJNaW4pIC8gMik7XG5cbiAgICAgIGxldCBhbmltYXRpb24gPSBcIlwiO1xuICAgICAgaWYgKHJveWFsdGllc1NsaWRlci52YWx1ZSA9PT0gcm95YWx0aWVzU2xpZGVyLm1heCkge1xuICAgICAgICBhbmltYXRpb24gPSBcImFuaW1hdGlvbjogYW5pbWF0ZUhlYXJ0IDEuMnMgaW5maW5pdGU7XCI7XG4gICAgICB9XG5cbiAgICAgIHJlZEhlYXJ0LmhpZGRlbiA9IGZhbHNlO1xuICAgICAgcmVkSGVhcnQuc3R5bGUgPSBgZm9udC1zaXplOiAke2ZvbnRTaXplfXJlbTsgJHthbmltYXRpb259YDtcbiAgICAgIGdyZWVuSGVhcnQuc3R5bGUgPSBgZm9udC1zaXplOiAke2ZvbnRTaXplfXJlbTsgb3BhY2l0eTogJHtcbiAgICAgICAgMSAtIHJlZEhlYXJ0T3BhY2l0eVxuICAgICAgfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZEhlYXJ0LmhpZGRlbiA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGUoKSB7XG4gICAgYXdhaXQgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuXG4gICAgY29uc3QgYXNzZXRJZHMgPSBbXTtcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjaW5wdXRBc3NldElkXCIpLmZvckVhY2goYXN5bmMgKGUpID0+IHtcbiAgICAgIGlmIChlLnZhbHVlICYmICFpc05hTihlLnZhbHVlKSkge1xuICAgICAgICBhc3NldElkcy5wdXNoKHBhcnNlSW50KGUudmFsdWUsIDEwKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGlzcGxheUFzc2V0SW5mbyhlKTtcbiAgICAgIH0gZWxzZSBpZiAoZS52YWx1ZSAmJiBpc05hTihlLnZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFdyb25nIGZvcm1hdCBmb3IgYXNzZXQgaWQgJHtlLnZhbHVlfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRhLmFzc2V0SWRzID0gYXNzZXRJZHM7XG4gICAgdGhpcy5kYXRhLmJ1eWVyQWRkcmVzcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEFsZ29BZGRyZXNzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5wcmljZSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFByaWNlXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5jdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5yb3lhbHRpZXNQZXJjZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5hY2NlcHRSaXNrID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NoZWNrQWNjZXB0Umlza1wiKS5jaGVja2VkO1xuXG4gICAgXG5cbiAgICBpZiAodGhpcy5kYXRhLmFzc2V0SWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYXNzZXQgaWQgcHJvdmlkZWQgb3Igd3JvbmcgZm9ybWF0XCIpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSAmJiAhdGhpcy5uZGZXYWxsZXRBZGRyZXNzKXtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5GRCBub3QgZm91bmRcIik7XG4gICAgfSBlbHNlIGlmICghdGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSAmJiAhYWxnb3Nkay5pc1ZhbGlkQWRkcmVzcyh0aGlzLmRhdGEuYnV5ZXJBZGRyZXNzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxnb3JhbmQgd2FsbGV0IGFkZHJlc3MgaXMgbm90IHZhbGlkXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnByaWNlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJpY2UgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnJveWFsdGllc1BlcmNlbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSb3lhbHRpZXMgdmFsdWUgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuZGF0YS5hY2NlcHRSaXNrKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSaXNrIG5vdCBhY2NlcHRlZFwiKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5kYXRhLmN1cnJlbmN5ID09PSBcIm5mdFwiICYmXG4gICAgICBpc05hTih0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRQcmljZUFzc2V0SWRcIikudmFsdWUpXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBXcm9uZyBmb3JtYXQgZm9yIGFzc2V0IGlkICR7XG4gICAgICAgICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0UHJpY2VBc3NldElkXCIpLnZhbHVlXG4gICAgICAgIH1gXG4gICAgICApO1xuICAgIH0gXG5cbiAgICBpZiAodGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSl7XG4gICAgICB0aGlzLmRhdGEuYnV5ZXJBZGRyZXNzID0gdGhpcy5uZGZXYWxsZXRBZGRyZXNzO1xuICAgIH1cblxuICAgIHRoaXMuZGF0YS5wcmljZUFzc2V0SWQgPSBwYXJzZUludChcbiAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFByaWNlQXNzZXRJZFwiKS52YWx1ZVxuICAgICk7XG5cbiAgICBcbiAgfVxuXG4gIGFzeW5jIHN1Ym1pdEZvcm0oZXZlbnQpIHtcbiAgICAvL2NhbmNlbCBkZWZhdWx0IGJlaGF2aW91ciB3aGVuIHN1Ym1pdGluZyBhIGZvcm1cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMudmFsaWRhdGUoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVycik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc3VibWl0Q2FsbGJhY2spIHtcbiAgICAgIHRoaXMuc3VibWl0Q2FsbGJhY2sodGhpcyk7XG4gICAgfVxuICB9XG5cbiAgbWFrZUJ1c3koKSB7XG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvblN1Ym1pdFwiKTtcbiAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgc3VibWl0QnV0dG9uLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCIgcm9sZT1cInN0YXR1c1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvc3Bhbj5cbiAgICBQcmV2aWV3YDtcbiAgfVxuXG4gIHN0b3BCdXN5KCkge1xuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b25TdWJtaXRcIik7XG4gICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJQcmV2aWV3XCI7XG4gICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJTd2FwTGlua0Zvcm0iLCJjb25zdHJ1Y3RvciIsImN1cnJlbmNpZXMiLCJkZWZhdWx0Um95YWx0aWVzIiwic3VibWl0Q2FsbGJhY2siLCJ3YWxsZXRDb25uZWN0IiwiYWxnb0luZGV4ZXIiLCJ0aGlzIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJkYXRhIiwiaXNBc3NldENyZWF0b3IiLCJudW1OZnRzIiwibmRmV2FsbGV0QWRkcmVzcyIsImlubmVySFRNTCIsImFkZE5GVCIsImlucHV0Q3VycmVuY3kiLCJxdWVyeVNlbGVjdG9yIiwiYWxnb09wdGlvbiIsInRleHRDb250ZW50IiwidmFsdWUiLCJzZWxlY3RlZCIsImFwcGVuZCIsIm5mdE9wdGlvbiIsImFzYU9wdEdyb3VwIiwibGFiZWwiLCJjdXJyZW5jeSIsIm9wdGlvbiIsIm5hbWUiLCJhc3NldElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJveWFsdGllc0NoYW5nZSIsImJpbmQiLCJjdXJyZW5jeUNoYW5nZSIsInN1Ym1pdEZvcm0iLCJjaGVja05mZCIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImV2ZW50IiwiY3VycmVudFRhcmdldCIsImhpZGRlbiIsIm5mdHNEaXYiLCJuZXdOZnQiLCJjbGFzc05hbWUiLCJpbnB1dEFzc2V0SWQiLCJyZXF1aXJlZCIsImFzc2V0SWRGb2N1c091dCIsImFkZExpbmsiLCJhc3luYyIsImRpc3BsYXlBc3NldEluZm8iLCJwYXJlbnQiLCJwYXJlbnROb2RlIiwiYXNzZXRJZEhlbHAiLCJhc3NldEltZyIsImlucHV0Um95YWx0aWVzIiwicm95YWx0aWVzZEhlbHAiLCJhc3NldElEIiwicGFyc2VJbnQiLCJpc05hTiIsImRpc2FibGVkIiwicmVzdWx0IiwibG9va3VwQXNzZXRCeUlEIiwiZG8iLCJhc3NldCIsInBhcmFtcyIsImNyZWF0b3IiLCJ3YWxsZXRBZGRyZXNzIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNoZWNrUm95YWx0aWVzQXZhaWxhYmlsaXR5IiwiYWRkcmVzcyIsImFkZHJlc3NIZWxwIiwidW5kZWZpbmVkIiwiZW5kc1dpdGgiLCJyZXNwb25zZSIsImZldGNoIiwic3RhdHVzIiwianNvbiIsIm93bmVyIiwiZXJyb3IiLCJuZnRJbnB1dCIsIm5mdExhYmVsIiwicHJpY2VJbnB1dCIsInByaWNlTGFiZWwiLCJncmVlbkhlYXJ0IiwicmVkSGVhcnQiLCJtdWx0aXBsZUNyZWF0b3JzIiwicHJldkNyZWF0b3IiLCJlIiwicXVlcnlTZWxlY3RvckFsbCIsInJveWFsdGllc1NsaWRlciIsInNsaWRlck1pbiIsIk51bWJlciIsIm1pbiIsInNsaWRlck1heCIsIm1heCIsImZvbnRTaXplIiwic3R5bGUiLCJyZWRIZWFydE9wYWNpdHkiLCJhbmltYXRpb24iLCJhc3NldElkcyIsImZvckVhY2giLCJwdXNoIiwiRXJyb3IiLCJidXllckFkZHJlc3MiLCJwcmljZSIsInJveWFsdGllc1BlcmNlbnQiLCJhY2NlcHRSaXNrIiwiY2hlY2tlZCIsImxlbmd0aCIsInByaWNlQXNzZXRJZCIsInByZXZlbnREZWZhdWx0IiwidmFsaWRhdGUiLCJhbGVydCIsIm1ha2VCdXN5Iiwic3VibWl0QnV0dG9uIiwic3RvcEJ1c3kiXSwic291cmNlUm9vdCI6IiJ9