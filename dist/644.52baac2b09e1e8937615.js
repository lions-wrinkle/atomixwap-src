"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[644],{644:(t,e,s)=>{s.r(e),s.d(e,{Claim:()=>o});var a=s(4050),n=s.n(a),i=s(9182),l=s(2592);class r{constructor(t,e){this.API_URL=i.Z.urls[i.Z.network].claimApiUrl,this.walletConnect=t,this.algodClient=e,this.claimables,this.suggestedParams,this.escrowAddress}async load(){const t=await fetch(this.API_URL+"/claim/get?recipient="+this.walletConnect.walletAddress),e=await t.json();this.claimables=e.claimables,this.suggestedParams=e.suggestedParams,this.escrowAddress=e.escrowAddress;for(const t of this.claimables){const e=await this.algodClient.getAssetByID(t.assetId).do();t.params=e.params}}getClaimablesUI(){let t=0,e=[];const s=document.createElement("div");let a,n,i=0;for(const r of this.claimables){0===t&&(a=document.createElement("div"),a.className="mt-4 mb-1",s.append(a),n=n=document.createElement("div"),n.className="row text-center gx-2 gy-2 mb-3",a.append(n));const o=document.createElement("div");if(o.className="col-6 col-md-3",o.innerHTML=`<div class="h-100 nft-card"><img src="default.png" class="img-fluid" id="nft-${r.assetId}"><div class="nft-card-info"><strong>${r.params.name}</strong><br>\n      <small><a href="https://www.nftexplorer.app/asset/${r.assetId}" target="_blank">${r.assetId}</a></small></div></div>`,(0,l.g)(r.assetId,o.querySelector(`#nft-${r.assetId}`),400),e.push(r.assetId),n.append(o),t++,i===this.claimables.length-1||8===t){const s=document.createElement("button");s.className="btn btn-generate",s.textContent="Claim "+(t>1?`(${t})`:""),s.dataset.assetIds=e.join(","),s.addEventListener("click",this.claim.bind(this),!1),a.append(s),t=0,e=[]}i++}return s}async claim(t){const e=t.currentTarget;try{e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Waiting for signatures...',e.disabled=!0;const s=t.currentTarget.dataset.assetIds.split(",");let a=[];for(const t of s){let e=a.find((e=>e.assetId===t));if(e)e.amount++;else{const e={assetId:t,amount:1};a.push(e)}}let i=[],l=[];for(const t of a){let e=n().makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(t.assetId),suggestedParams:this.suggestedParams});i.push(e);let s=n().makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:t.amount,assetIndex:parseInt(t.assetId),suggestedParams:this.suggestedParams});l.push(s)}let r=i.concat(l);n().assignGroupID(r);const o=await this.walletConnect.signTransactions(r);let c=[];for(let t=0;t<o.length;t++)c.push({amount:a[t].amount,txn:btoa(String.fromCharCode.apply(null,o[t]))});e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Claiming...',e.disabled=!0;const d=await fetch(this.API_URL+"/claim/claim",{method:"POST",body:JSON.stringify({signedTxns:c}),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==d.status){const t=await d.json();throw new Error(t.error)}await d.json(),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Claimed',e.disabled=!0}catch(t){console.error(t),alert(t.message),e.textContent="Claim",e.disabled=!1}}}class o{constructor(t,e){this.walletConnect=t,this.algodClient=e,this.ui=document.createElement("div"),this.claimApi=new r(this.walletConnect,this.algodClient),this.displayUI(),this.loadClaimables()}displayUI(){this.ui.innerHTML='\n        <h4 id="claim-title">Claim</h4>\n        <div id="claim-list">Loading...</div>\n        '}async loadClaimables(){try{await this.claimApi.load()}catch(t){return console.error(t),void(this.ui.innerHTML=`\n        <h4 id="claim-title">Claim</h4>\n        <div class="alert alert-danger" role="alert">${t.message}</div>\n        `)}const t=this.ui.querySelector("#claim-title"),e=this.ui.querySelector("#claim-list"),s=this.claimApi.claimables.length;0===s?(t.textContent="ðŸ˜ž",e.textContent="No NFTS to claim."):(t.textContent=`${s} NFT${s>1?"s":""} to claim! ðŸ¥³`,e.textContent="",e.append(this.claimApi.getClaimablesUI()))}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNYdkYsWUFBWUMsRUFBZUMsR0FDekJDLEtBQUtGLGNBQWdCQSxFQUNyQkUsS0FBS0QsWUFBY0EsRUFFbkJDLEtBQUtxRixHQUFLOUQsU0FBU0MsY0FBYyxPQUNqQ3hCLEtBQUtzRixTQUFXLElBQUkxRixFQUFnQkksS0FBS0YsY0FBZUUsS0FBS0QsYUFFN0RDLEtBQUt1RixZQUNMdkYsS0FBS3dGLGdCQUNQLENBRUFELFlBQ0V2RixLQUFLcUYsR0FBR3RELFVBQVksb0dBSXRCLENBRUF4Qix1QkFDRSxVQUNRUCxLQUFLc0YsU0FBU0csTUFRdEIsQ0FQRSxNQUFPVCxHQU1QLE9BTEVDLFFBQVFGLE1BQU1DLFFBQ2hCaEYsS0FBS3FGLEdBQUd0RCxVQUFZLG1HQUU2QmlELEVBQUlHLDBCQUd2RCxDQUVBLE1BQU1PLEVBQVExRixLQUFLcUYsR0FBR3BELGNBQWMsZ0JBQzlCWCxFQUFhdEIsS0FBS3FGLEdBQUdwRCxjQUFjLGVBRW5DMEQsRUFBZ0IzRixLQUFLc0YsU0FBU2xGLFdBQVcrQixPQUV6QixJQUFsQndELEdBQ0ZELEVBQU1yRCxZQUFjLEtBQ3BCZixFQUFXZSxZQUFjLHNCQUV6QnFELEVBQU1yRCxZQUFjLEdBQUdzRCxRQUNyQkEsRUFBZ0IsRUFBSSxJQUFNLGtCQUc1QnJFLEVBQVdlLFlBQWMsR0FDekJmLEVBQVdPLE9BQU83QixLQUFLc0YsU0FBU25FLG1CQUVwQyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXRvbWl4d2FwLy4vc3JjL2NsYWltLWFwaS13cmFwcGVyLmpzIiwid2VicGFjazovL2F0b21peHdhcC8uL3NyYy9jbGFpbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYWxnb3NkayBmcm9tIFwiYWxnb3Nka1wiO1xuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWcuanNcIjtcbmltcG9ydCB7IGxvYWRBc3NldEltYWdlIH0gZnJvbSBcIi4vYXNzZXQtZGV0YWlscy5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDbGFpbUFwaVdyYXBwZXIge1xuICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBhbGdvZENsaWVudCkge1xuICAgIHRoaXMuQVBJX1VSTCA9IGNvbmZpZy51cmxzW2NvbmZpZy5uZXR3b3JrXS5jbGFpbUFwaVVybDtcblxuICAgIHRoaXMud2FsbGV0Q29ubmVjdCA9IHdhbGxldENvbm5lY3Q7XG4gICAgdGhpcy5hbGdvZENsaWVudCA9IGFsZ29kQ2xpZW50O1xuXG4gICAgdGhpcy5jbGFpbWFibGVzO1xuICAgIHRoaXMuc3VnZ2VzdGVkUGFyYW1zO1xuICAgIHRoaXMuZXNjcm93QWRkcmVzcztcbiAgfVxuXG4gIGFzeW5jIGxvYWQoKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIHRoaXMuQVBJX1VSTCArIFwiL2NsYWltL2dldD9yZWNpcGllbnQ9XCIgKyB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzc1xuICAgICk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgdGhpcy5jbGFpbWFibGVzID0gZGF0YS5jbGFpbWFibGVzO1xuICAgIHRoaXMuc3VnZ2VzdGVkUGFyYW1zID0gZGF0YS5zdWdnZXN0ZWRQYXJhbXM7XG4gICAgdGhpcy5lc2Nyb3dBZGRyZXNzID0gZGF0YS5lc2Nyb3dBZGRyZXNzO1xuXG4gICAgLy9sb2FkIGFzc2V0cyBkZXRhaWxzXG4gICAgZm9yIChjb25zdCBjbGFpbWFibGUgb2YgdGhpcy5jbGFpbWFibGVzKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29kQ2xpZW50XG4gICAgICAgIC5nZXRBc3NldEJ5SUQoY2xhaW1hYmxlLmFzc2V0SWQpXG4gICAgICAgIC5kbygpO1xuICAgICAgY2xhaW1hYmxlLnBhcmFtcyA9IHJlc3VsdC5wYXJhbXM7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2xhaW1hYmxlc1VJKCkge1xuICAgIGNvbnN0IG1heFR4ID0gODtcblxuICAgIGxldCB0eENvdW50ID0gMDtcbiAgICBsZXQgYXNzZXRJZHMgPSBbXTtcblxuICAgIGNvbnN0IGNvbnRlbnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgbGV0IGkgPSAwO1xuXG4gICAgbGV0IGJhdGNoRGl2O1xuICAgIGxldCBiYXRjaFJvdztcblxuICAgIGZvciAoY29uc3QgY2xhaW1hYmxlIG9mIHRoaXMuY2xhaW1hYmxlcykge1xuICAgICAgaWYgKHR4Q291bnQgPT09IDApIHtcbiAgICAgICAgYmF0Y2hEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBiYXRjaERpdi5jbGFzc05hbWUgPSBcIm10LTQgbWItMVwiO1xuICAgICAgICBjb250ZW50RGl2LmFwcGVuZChiYXRjaERpdik7XG5cbiAgICAgICAgYmF0Y2hSb3cgPSBiYXRjaFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGJhdGNoUm93LmNsYXNzTmFtZSA9IFwicm93IHRleHQtY2VudGVyIGd4LTIgZ3ktMiBtYi0zXCI7XG4gICAgICAgIGJhdGNoRGl2LmFwcGVuZChiYXRjaFJvdyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBjb2wuY2xhc3NOYW1lID0gXCJjb2wtNiBjb2wtbWQtM1wiO1xuICAgICAgY29sLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwiaC0xMDAgbmZ0LWNhcmRcIj48aW1nIHNyYz1cImRlZmF1bHQucG5nXCIgY2xhc3M9XCJpbWctZmx1aWRcIiBpZD1cIm5mdC0ke2NsYWltYWJsZS5hc3NldElkfVwiPjxkaXYgY2xhc3M9XCJuZnQtY2FyZC1pbmZvXCI+PHN0cm9uZz4ke2NsYWltYWJsZS5wYXJhbXMubmFtZX08L3N0cm9uZz48YnI+XG4gICAgICA8c21hbGw+PGEgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke2NsYWltYWJsZS5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7Y2xhaW1hYmxlLmFzc2V0SWR9PC9hPjwvc21hbGw+PC9kaXY+PC9kaXY+YDtcblxuICAgICAgbG9hZEFzc2V0SW1hZ2UoXG4gICAgICAgIGNsYWltYWJsZS5hc3NldElkLFxuICAgICAgICBjb2wucXVlcnlTZWxlY3RvcihgI25mdC0ke2NsYWltYWJsZS5hc3NldElkfWApLFxuICAgICAgICA0MDBcbiAgICAgICk7XG5cbiAgICAgIGFzc2V0SWRzLnB1c2goY2xhaW1hYmxlLmFzc2V0SWQpO1xuXG4gICAgICBiYXRjaFJvdy5hcHBlbmQoY29sKTtcblxuICAgICAgdHhDb3VudCsrO1xuXG4gICAgICBpZiAoaSA9PT0gdGhpcy5jbGFpbWFibGVzLmxlbmd0aCAtIDEgfHwgdHhDb3VudCA9PT0gbWF4VHgpIHtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgYnV0dG9uLmNsYXNzTmFtZSA9IFwiYnRuIGJ0bi1nZW5lcmF0ZVwiO1xuXG4gICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGBDbGFpbSAke3R4Q291bnQgPiAxID8gYCgke3R4Q291bnR9KWAgOiBcIlwifWA7XG4gICAgICAgIGJ1dHRvbi5kYXRhc2V0LmFzc2V0SWRzID0gYXNzZXRJZHMuam9pbihcIixcIik7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5jbGFpbS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgICAgYmF0Y2hEaXYuYXBwZW5kKGJ1dHRvbik7XG5cbiAgICAgICAgdHhDb3VudCA9IDA7XG4gICAgICAgIGFzc2V0SWRzID0gW107XG4gICAgICB9XG5cbiAgICAgIGkrKztcbiAgICB9XG5cbiAgICByZXR1cm4gY29udGVudERpdjtcbiAgfVxuXG4gIGFzeW5jIGNsYWltKGV2ZW50KSB7XG4gICAgY29uc3QgY2FsbGluZ0J1dHRvbiA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG5cbiAgICB0cnkge1xuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICBXYWl0aW5nIGZvciBzaWduYXR1cmVzLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICBjb25zdCBhc3NldElkcyA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5hc3NldElkcy5zcGxpdChcIixcIik7XG5cbiAgICAgIC8vZ3JvdXAgYnkgYXNzZXRJZHNcbiAgICAgIGxldCBjbGFpbUxpc3QgPSBbXTtcblxuICAgICAgZm9yIChjb25zdCBhc3NldElkIG9mIGFzc2V0SWRzKSB7XG4gICAgICAgIGxldCBjbGFpbSA9IGNsYWltTGlzdC5maW5kKChjKSA9PiBjLmFzc2V0SWQgPT09IGFzc2V0SWQpO1xuXG4gICAgICAgIGlmICghY2xhaW0pIHtcbiAgICAgICAgICBjb25zdCBuZXdDbGFpbSA9IHtcbiAgICAgICAgICAgIGFzc2V0SWQ6IGFzc2V0SWQsXG4gICAgICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjbGFpbUxpc3QucHVzaChuZXdDbGFpbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xhaW0uYW1vdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IG9wdGluVHhucyA9IFtdO1xuICAgICAgbGV0IHRyYW5zZmVyVHhucyA9IFtdO1xuXG4gICAgICBmb3IgKGNvbnN0IGNsYWltIG9mIGNsYWltTGlzdCkge1xuICAgICAgICAvL3ByZXBhcmUgb3B0aW4gdHhuXG4gICAgICAgIGxldCBvcHRpblR4biA9XG4gICAgICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgICAgIGZyb206IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICAgICAgYW1vdW50OiAwLFxuICAgICAgICAgICAgYXNzZXRJbmRleDogcGFyc2VJbnQoY2xhaW0uYXNzZXRJZCksXG4gICAgICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHRoaXMuc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIG9wdGluVHhucy5wdXNoKG9wdGluVHhuKTtcblxuICAgICAgICAvL3ByZXBhcmUgdHJhbnNmZXIgdHhuXG4gICAgICAgIGxldCB0cmFuc2ZlclR4biA9XG4gICAgICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgICAgIGZyb206IHRoaXMuZXNjcm93QWRkcmVzcyxcbiAgICAgICAgICAgIHRvOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgICAgIGFtb3VudDogY2xhaW0uYW1vdW50LFxuICAgICAgICAgICAgYXNzZXRJbmRleDogcGFyc2VJbnQoY2xhaW0uYXNzZXRJZCksXG4gICAgICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHRoaXMuc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRyYW5zZmVyVHhucy5wdXNoKHRyYW5zZmVyVHhuKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGFsbFR4bnMgPSBvcHRpblR4bnMuY29uY2F0KHRyYW5zZmVyVHhucyk7XG4gICAgICBhbGdvc2RrLmFzc2lnbkdyb3VwSUQoYWxsVHhucyk7XG5cbiAgICAgIGNvbnN0IHNpZ25lZFR4bnMgPSBhd2FpdCB0aGlzLndhbGxldENvbm5lY3Quc2lnblRyYW5zYWN0aW9ucyhhbGxUeG5zKTtcblxuICAgICAgbGV0IHNpZ25lZFR4bnNKc29uID0gW107XG4gICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2lnbmVkVHhucy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIHNpZ25lZFR4bnNKc29uLnB1c2goe1xuICAgICAgICAgIGFtb3VudDogY2xhaW1MaXN0W2ldLmFtb3VudCxcbiAgICAgICAgICB0eG46IGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBzaWduZWRUeG5zW2ldKSlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8qY29uc3Qgc2lnbmVkVHhuc1JhdyA9IHNpZ25lZFR4bnMubWFwKCh0eEJsb2IpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbW91bnQ6IDAsXG4gICAgICAgICAgdHhuOiBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdHhCbG9iKSksXG4gICAgICAgIH07XG4gICAgICB9KTsqL1xuXG4gICAgICBjYWxsaW5nQnV0dG9uLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCIgcm9sZT1cInN0YXR1c1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvc3Bhbj5cbiAgICAgIENsYWltaW5nLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG5cbiAgICAgIC8vY2FsbCBhcGlcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5BUElfVVJMICsgXCIvY2xhaW0vY2xhaW1cIiwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHNpZ25lZFR4bnM6IHNpZ25lZFR4bnNKc29uIH0pLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICBjYWxsaW5nQnV0dG9uLmlubmVySFRNTCA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiBmaWxsPVwiY3VycmVudENvbG9yXCIgY2xhc3M9XCJiaSBiaS1jaGVjay1jaXJjbGUtZmlsbFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIj5cbiAgICAgICAgPHBhdGggZD1cIk0xNiA4QTggOCAwIDEgMSAwIDhhOCA4IDAgMCAxIDE2IDB6bS0zLjk3LTMuMDNhLjc1Ljc1IDAgMCAwLTEuMDguMDIyTDcuNDc3IDkuNDE3IDUuMzg0IDcuMzIzYS43NS43NSAwIDAgMC0xLjA2IDEuMDZMNi45NyAxMS4wM2EuNzUuNzUgMCAwIDAgMS4wNzktLjAybDMuOTkyLTQuOTlhLjc1Ljc1IDAgMCAwLS4wMS0xLjA1elwiLz5cbiAgICAgIDwvc3ZnPlxuICAgICAgICBDbGFpbWVkYDtcbiAgICAgICAgY2FsbGluZ0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIGFsZXJ0KGVyci5tZXNzYWdlKTtcblxuICAgICAgY2FsbGluZ0J1dHRvbi50ZXh0Q29udGVudCA9IFwiQ2xhaW1cIjtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCBDbGFpbUFwaVdyYXBwZXIgZnJvbSBcIi4vY2xhaW0tYXBpLXdyYXBwZXIuanNcIjtcblxuZXhwb3J0IGNsYXNzIENsYWltIHtcbiAgY29uc3RydWN0b3Iod2FsbGV0Q29ubmVjdCwgYWxnb2RDbGllbnQpIHtcbiAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgIHRoaXMuYWxnb2RDbGllbnQgPSBhbGdvZENsaWVudDtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMuY2xhaW1BcGkgPSBuZXcgQ2xhaW1BcGlXcmFwcGVyKHRoaXMud2FsbGV0Q29ubmVjdCwgdGhpcy5hbGdvZENsaWVudCk7XG5cbiAgICB0aGlzLmRpc3BsYXlVSSgpO1xuICAgIHRoaXMubG9hZENsYWltYWJsZXMoKTtcbiAgfVxuXG4gIGRpc3BsYXlVSSgpIHtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICAgICAgPGg0IGlkPVwiY2xhaW0tdGl0bGVcIj5DbGFpbTwvaDQ+XG4gICAgICAgIDxkaXYgaWQ9XCJjbGFpbS1saXN0XCI+TG9hZGluZy4uLjwvZGl2PlxuICAgICAgICBgO1xuICB9XG5cbiAgYXN5bmMgbG9hZENsYWltYWJsZXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY2xhaW1BcGkubG9hZCgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICAgICAgPGg0IGlkPVwiY2xhaW0tdGl0bGVcIj5DbGFpbTwvaDQ+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJhbGVydCBhbGVydC1kYW5nZXJcIiByb2xlPVwiYWxlcnRcIj4ke2Vyci5tZXNzYWdlfTwvZGl2PlxuICAgICAgICBgO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHRpdGxlID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NsYWltLXRpdGxlXCIpO1xuICAgIGNvbnN0IGNvbnRlbnREaXYgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2xhaW0tbGlzdFwiKTtcblxuICAgIGNvbnN0IG51bUNsYWltYWJsZXMgPSB0aGlzLmNsYWltQXBpLmNsYWltYWJsZXMubGVuZ3RoO1xuXG4gICAgaWYgKG51bUNsYWltYWJsZXMgPT09IDApIHtcbiAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gXCLwn5ieXCI7XG4gICAgICBjb250ZW50RGl2LnRleHRDb250ZW50ID0gXCJObyBORlRTIHRvIGNsYWltLlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGAke251bUNsYWltYWJsZXN9IE5GVCR7XG4gICAgICAgIG51bUNsYWltYWJsZXMgPiAxID8gXCJzXCIgOiBcIlwiXG4gICAgICB9IHRvIGNsYWltISDwn6WzYDtcblxuICAgICAgY29udGVudERpdi50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICBjb250ZW50RGl2LmFwcGVuZCh0aGlzLmNsYWltQXBpLmdldENsYWltYWJsZXNVSSgpKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJDbGFpbUFwaVdyYXBwZXIiLCJjb25zdHJ1Y3RvciIsIndhbGxldENvbm5lY3QiLCJhbGdvZENsaWVudCIsInRoaXMiLCJBUElfVVJMIiwiY29uZmlnIiwiY2xhaW1BcGlVcmwiLCJjbGFpbWFibGVzIiwic3VnZ2VzdGVkUGFyYW1zIiwiZXNjcm93QWRkcmVzcyIsImFzeW5jIiwicmVzcG9uc2UiLCJmZXRjaCIsIndhbGxldEFkZHJlc3MiLCJkYXRhIiwianNvbiIsImNsYWltYWJsZSIsInJlc3VsdCIsImdldEFzc2V0QnlJRCIsImFzc2V0SWQiLCJkbyIsInBhcmFtcyIsImdldENsYWltYWJsZXNVSSIsInR4Q291bnQiLCJhc3NldElkcyIsImNvbnRlbnREaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJiYXRjaERpdiIsImJhdGNoUm93IiwiaSIsImNsYXNzTmFtZSIsImFwcGVuZCIsImNvbCIsImlubmVySFRNTCIsIm5hbWUiLCJxdWVyeVNlbGVjdG9yIiwicHVzaCIsImxlbmd0aCIsImJ1dHRvbiIsInRleHRDb250ZW50IiwiZGF0YXNldCIsImpvaW4iLCJhZGRFdmVudExpc3RlbmVyIiwiY2xhaW0iLCJiaW5kIiwiZXZlbnQiLCJjYWxsaW5nQnV0dG9uIiwiY3VycmVudFRhcmdldCIsImRpc2FibGVkIiwic3BsaXQiLCJjbGFpbUxpc3QiLCJmaW5kIiwiYyIsImFtb3VudCIsIm5ld0NsYWltIiwib3B0aW5UeG5zIiwidHJhbnNmZXJUeG5zIiwib3B0aW5UeG4iLCJmcm9tIiwidG8iLCJhc3NldEluZGV4IiwicGFyc2VJbnQiLCJ0cmFuc2ZlclR4biIsImFsbFR4bnMiLCJjb25jYXQiLCJzaWduZWRUeG5zIiwic2lnblRyYW5zYWN0aW9ucyIsInNpZ25lZFR4bnNKc29uIiwidHhuIiwiYnRvYSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImFwcGx5IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiQWNjZXB0Iiwic3RhdHVzIiwiRXJyb3IiLCJlcnJvciIsImVyciIsImNvbnNvbGUiLCJhbGVydCIsIm1lc3NhZ2UiLCJDbGFpbSIsInVpIiwiY2xhaW1BcGkiLCJkaXNwbGF5VUkiLCJsb2FkQ2xhaW1hYmxlcyIsImxvYWQiLCJ0aXRsZSIsIm51bUNsYWltYWJsZXMiXSwic291cmNlUm9vdCI6IiJ9